import{ak as _,Y as W,r as v,Q as H,G as T,x as B,am as J}from"./index-U57YJnlT.js";const Z=u=>_.post("/api/system/microservice/resource/",u),ee=u=>_.post("/api/system/microservice/create_mock/",u),te=u=>_.get(`/api/system/microservice/get_mock/${u}/`),oe=u=>_.get(`/api/system/microservice/answer_status/${u}/`),se=u=>_.post("/api/system/microservice/answer_panel/",u),re=u=>_.post(`/api/system/microservice/submit_answers/${u}/`),O=u=>_.post(`/api/system/microservice/scoring/${u}/`),P=u=>_.get(`/api/system/microservice/get_score/${u}/`),U=u=>_.get(`/api/system/microservice/get_score_repeat/${u}/`),ne=u=>_.get(`/api/system/microservice/get_past_scores/${u}/`),ae=(u,C)=>_.post("/api/system/microservice/grade_answer/",{sheet_id:u,question_id:C}),ce=u=>_.post("/api/system/microservice/create_mock_sheet/",u),$={10:"A+",9:"A",8:"A-","7.5":"B+",7:"B",6:"B-","5.5":"C+",5:"C",4:"C-",0:"F"},K={"Integrated Writing":[{key:"Content & Details Given",title:"内容与细节"},{key:"Grammar",title:"语法"},{key:"Structure/Flow",title:"结构与流畅度"}],"Academic discussion":[{key:"Contribution",title:"内容贡献"},{key:"Relevance",title:"相关性"},{key:"Structure/Flow",title:"结构与流畅度"},{key:"Grammar",title:"语法"}]},Q=[{key:["Fluency","Pronunciation"],title:"流利度"},{key:["Grammar","Vocabulary Usage"],title:"语法与词汇"},{key:"Content",title:"内容"},{key:"Coherence",title:"连贯性"}],R=[{type:"内容",id:"Content",style:{color:"#667085",background:"rgba(253, 212, 78, 0.3)"}},{type:"连贯性",id:"Coherence",style:{color:"#667085","text-decoration-line":"underline","text-decoration-color":"#667085"}},{type:"语法",id:"Grammar and Language Use",style:{color:"#667085","text-decoration-line":"underline","text-decoration-style":"dashed","text-decoration-color":"#C33473"}},{type:"优秀用句",id:"Good",style:{color:"#667085",background:"rgba(183, 217, 114, 0.3)"}}],V=[{type:"内容与细节",id:"Content & Details Given",style:{color:"#667085",background:"rgba(253, 212, 78, 0.3)"}},{type:"结构与流畅度",id:"Structure/Flow",style:{color:"#667085","text-decoration-line":"underline","text-decoration-color":"#667085"}},{type:"语法",id:"Grammar",style:{color:"#667085","text-decoration-line":"underline","text-decoration-style":"dashed","text-decoration-color":"#C33473"}},{type:"优秀用句",id:"Good",style:{color:"#667085",background:"rgba(183, 217, 114, 0.3)"}}],Y=[{type:"贡献度与相关性",id:["Contribution","Relevance"],style:{color:"#667085",background:"rgba(253, 212, 78, 0.3)"}},{type:"结构与流畅度",id:"Structure/Flow",style:{color:"#667085","text-decoration-line":"underline","text-decoration-color":"#667085"}},{type:"语法",id:"Grammar",style:{color:"#667085","text-decoration-line":"underline","text-decoration-style":"dashed","text-decoration-color":"#C33473"}},{type:"优秀用句",id:"Good",style:{color:"#667085",background:"rgba(183, 217, 114, 0.3)"}}],ie=W("result",()=>{const u=v(!1),C=H(),a=T({loading:!0,title:"",level:"",footerActiveIndex:0,allData:[],aiComment:"",questions_r:{},format_question:[],score_d:[]}),h=T([]),I=e=>e.replace(/TPO\s?\d+/g,""),M=()=>{u.value=!u.value},G=async e=>{await J(5e3),await O(e);const i=await U(e);i.score===null?G(e):F(i)},A=e=>{const i=e==null?void 0:e.model_answer;if(!i)return{model_answer_content:{},model_answer:""};const s=typeof i=="string"?JSON.parse(i):i;if(s["General Feedback"]){const n=s["General Feedback"].split(/\n?(.+):\s/i).slice(1);s.format_G_F=new Array(n.length/2).fill(0).reduce((r,o,c)=>(r[n[c*2]]=n[c*2+1],r),{})}return s["Mind-Map"]&&(s.format_M_M=s["Mind-Map"].split(/\n/)),{model_answer_content:s,model_answer:i}},D=(e,i)=>{const s=JSON.parse(JSON.stringify(e));return s.forEach(n=>{const r=i==null?void 0:i.filter(o=>n.include.includes(o.name));n.total=0,n.count=0,r==null||r.forEach(o=>{n.total+=o.count,n.count+=o.sum}),n.isComputed=!0}),{list:s,tags:i==null?void 0:i.map(n=>({...n,name:n.name.replace(/^(阅读|听力)/g,"")}))}},N=e=>{const{query:i}=C,s=Object.values(e.score_d);if(i.type==="hearing"){const n=[{title:"基础题",include:["听力目的主旨题","听力内容主旨题","听力细节题"]},{title:"强化题",include:["听力推理题","听力句子功能题","听力连结内容题","听力组织结构题"]}],r=s.map(c=>{const t=c.find(g=>g.name.endsWith("Conversation2")||g.name.endsWith("Lecture3")||g.name.endsWith("Lecture4"))?2:1;return{title:"Section "+t,id:t}});let o=0;return a.allData[0]={layout:"col",name:"听力得分",mockScore:e.score,mockScoreTotal:e.max_score,level:k(e.score,e.max_score),aiComment:"",list:s.map((c,t)=>{const g=c.reduce((y,d)=>(d.name.includes("Conversation")?y.unshift(d):y.push(d),y),[]);return{...r[t],children:g.map((y,d)=>{var l,m;return{title:y.name.split(/\s/).slice(-1)[0],id:`${t}-${d}`,count:y.count,total:y.total,isComputed:c.score!==null,index:d+t*3,navNum:(m=(l=e.questions_r)==null?void 0:l.questions)==null?void 0:m[d+t*3].children.map(()=>o++)}})}})},a.allData.push(...r.map((c,t)=>{var d,l;const g=(d=s[t])==null?void 0:d.reduce((m,p)=>m+p.count,0),y=(l=s[t])==null?void 0:l.reduce((m,p)=>m+p.total,0);return{subtitle:c.title,layout:"row",level:k(g,y),name:"Raw Score",mockScore:g,mockScoreTotal:y,...D(n,e.tag_d[t+1]),aiComment:""}})),r}else if(i.type==="spoken"){const n=s[0].map((r,o)=>({title:"Task "+r.name.split(/\s/).slice(-1)[0],id:`${o}`}));return a.allData[0]={layout:"col",name:"口语得分",level:k(e.score,n.length===4?30:e==null?void 0:e.max_score),mockScore:e==null?void 0:e.score,mockScoreTotal:n.length===4?30:e==null?void 0:e.max_score,list:e.questions_r.questions.map((r,o)=>({title:"Task "+r.order,id:o,isComputed:r.score!==null,count:r.score,total:r.max_score}))},a.allData.push(...n.map((r,o)=>{var d;const{model_answer:c,model_answer_content:t}=A(e.questions_r.questions[o]),g=t==null?void 0:t.Content.filter(l=>Object.keys(l).length>0),y=R;return{layout:"col",name:r.title,level:k(e.questions_r.questions[o].score,e.questions_r.questions[o].max_score),mockScore:e.questions_r.questions[o].score,mockScoreTotal:e.questions_r.questions[o].max_score,aiComment:(d=t==null?void 0:t.format_G_F)==null?void 0:d.General,model_answer:c,model_answer_content:{...t,sent_back:g.map(l=>Object.keys(l).reduce((m,p)=>{var x;const q=(x=t["Sentence Feedback"][p].Type)==null?void 0:x.reduce((w,f)=>{var S;return{...(S=y.find(b=>b.id===f||b.id.includes(f)))==null?void 0:S.style}},{});return m[p]={...t["Sentence Feedback"][p],original:l[p],style:q,curStyle:{...q},aiStyle:{...q}},m},{}))},question:e.questions_r.questions[o],curIndex:o+1,length:e.questions_r.questions.length,ques_mark:R,list:Q.map(l=>{var p,q;const m=Array.isArray(l.key)?l.key.reduce((x,w)=>{var f;return Number((f=t==null?void 0:t.Grades)==null?void 0:f[w])+x},0):(p=t==null?void 0:t.Grades)==null?void 0:p[l.key];return{title:l.title,count:t?m/2:(q=t==null?void 0:t.Grades)==null?void 0:q[r.key],isComputed:(t==null?void 0:t.Status)==="OK",total:4}})}})),n}else if(i.type==="writing"){const n=s.map((r,o)=>({title:Number(r[0].name.slice(-1))===1?"Integrated Writing":"Academic discussion",id:`${o}`}));return a.allData[0]={layout:"col",name:"写作得分",mockScore:e.score,mockScoreTotal:n.length*15,level:k(e.score,n.length*15),list:e.questions_r.questions.map((r,o)=>({title:r.keywords.r===1200?"Integrated Writing":"Academic discussion",id:o,isComputed:r.score!==null,count:r.score,total:r.max_score})),aiComment:""},a.allData.push(...n.map((r,o)=>{var d;const{model_answer:c,model_answer_content:t}=A(e.questions_r.questions[o]),g=t==null?void 0:t.Content.filter(l=>Object.keys(l).length>0);console.log(t);const y=r.title==="Integrated Writing"?V:Y;return{layout:"col",name:r.title,ques_mark:y,mockScore:e.questions_r.questions[o].score,mockScoreTotal:e.questions_r.questions[o].max_score,level:k(e.questions_r.questions[o].score,e.questions_r.questions[o].max_score),aiComment:(d=t==null?void 0:t.format_G_F)==null?void 0:d.General,model_answer:c,model_answer_content:{...t,sent_back:g.map(l=>Object.keys(l).reduce((m,p)=>{var x;const q=(x=t["Sentence Feedback"][p].Type)==null?void 0:x.reduce((w,f)=>{var S;return{...(S=y.find(b=>b.id===f||b.id.includes(f)))==null?void 0:S.style}},{});return m[p]={...t["Sentence Feedback"][p],original:l[p],style:q,curStyle:{...q},aiStyle:{...q}},m},{}))},question:e.questions_r.questions[o],curIndex:o+1,length:e.questions_r.questions.length,list:K[r.title].map(l=>{var m,p;return{title:l.title,count:((m=t==null?void 0:t.Grades)==null?void 0:m[l.key])||0,isComputed:((p=t==null?void 0:t.Grades)==null?void 0:p[l.key])!==null,total:5}})}})),n}else{const n=[{title:"基础题",include:["阅读词汇题","阅读指代题","阅读简化句子题","阅读细节题","阅读排除题"]},{title:"强化题",include:["阅读修辞目的题","阅读插入句子题","阅读推断题"]},{title:"文章小结题",include:["阅读文章内容小结题","阅读表格题"]}],r=s.map((o,c)=>({title:I(o[0].name),id:`${c}`}));return a.allData[0]={layout:"row",name:"模考得分",mockScore:e.score,mockScoreTotal:e.max_score,level:k(e.score,e.max_score),aiComment:"",...D(n,e.tag_d.all)},a.allData.push(...r.map((o,c)=>{var y,d;const t=(y=s[c])==null?void 0:y.reduce((l,m)=>l+m.count,0),g=(d=s[c])==null?void 0:d.reduce((l,m)=>l+m.total,0);return{layout:"row",name:"Raw Score",subtitle:o.title,mockScore:t,mockScoreTotal:g,level:k(t,g),aiComment:"",...D(n,e.tag_d[c+1])}})),r}},k=(e,i)=>{const s=e*(10/i),n=Object.keys($).sort((o,c)=>o-c),r=n.find((o,c)=>(console.log(s),s>=Number(o)&&s<Number(c===n.length-1?11:n[c+1])),0);return $[r]},F=e=>{a.questions_r=e.questions_r,a.score_d=Object.values(e.score_d),a.format_question=e.questions_r.questions.reduce((i,s)=>(i.push(...Array.isArray(s.children)&&s.children.length?s.children.map(n=>{var o;const r=(o=s.question_content)==null?void 0:o.split(/\\n/);return{...n,question_parent:{...s,original_question_content:r,question_content:r==null?void 0:r.map(c=>c.replaceAll(s.keywords.k,"")),question_title:s.question_title?s.question_title:"听力原文",children:null}}}):[]),i),[]),h.length=0,h.push({title:"报告",id:"all"},...N(e)),a.title=`${a.score_d[0][0].name.match(/^(TPO\s?\d+)/)[1]} 成绩单`,a.loading=!1},E=e=>{const i=[{title:"阅读",id:"reading",layout:"row"},{title:"听力",id:"hearing",layout:"col"},{title:"口语",id:"spoken",layout:"col"},{title:"写作",id:"writing",layout:"table"}];a.questions_r=[],a.score_d=[],a.format_question=[],h.length=0,h[0]={title:"模考",id:"all"},h.push(...i),a.allData[0]={layout:"col",name:"总分",mockScore:e.score,mockScoreTotal:120,aiComment:"",list:i.map((s,n)=>({title:s.title,isComputed:!0,total:e.detail[n].max_score,count:e.detail[n].score}))},a.allData.push(...i.map((s,n)=>({}))),a.loading=!1},j=async e=>{const{query:i}=C;a.title="",a.level="",a.footerActiveIndex=0,a.allData=[],a.aiComment="",a.questions_r={},a.format_question=[],a.score_d=[],a.loading=!0,h.length=0,await O(e);const s=await P(e);if(s.score!==null){if(i.type==="mock"){E(s);return}F(s)}else G(e)},L=B(()=>a.allData[a.footerActiveIndex]);return{getExamResult:j,showHoverMark:(e,i,s,n)=>{var o;((o=a.allData.slice(1)[s])==null?void 0:o.model_answer_content.sent_back).map(c=>{Object.keys(c).map(t=>{n==="hover"?e===t?c[t].curStyle={...c[e].style,"font-weight":"700"}:c[t].curStyle={}:c[t].curStyle=c[t].style})})},curData:L,resultData:a,setShowAnswerHistoryDialog:M,showAnswerHistoryDialog:u,footerData:h}});export{oe as a,re as b,O as c,P as d,se as e,ae as f,Z as g,ee as h,ce as i,ne as j,te as r,ie as u};
