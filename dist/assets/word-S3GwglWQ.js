import{s as q}from"./ai-NWxVyCju.js";import{ak as n,X as j,p as I,G as E,N,C as l,r as $}from"./index-ZyeamsUE.js";const D=a=>n.get(`api/system/microservice/get_vocabs_statics/${a}/`),R=a=>n.get(`api/system/microservice/get_vocabs_tasks/${a}/`),T=a=>n.post("api/system/microservice/start_task/",{task_account_id:a}),v=a=>n.post("api/system/microservice/learning_task/",a),k=a=>n.post(`api/system/microservice/refuse_jump_vocabs/${a}/`),b=a=>n.post("/api/system/microservice/jump_vocabs/",a),X=j("word",()=>{const a=I(),y=E(),d=N(),o=l({is_skip_remind:null,last_day_review:0,last_day_study:0,series:[{correct_words:0,day:"2024-03-04",wrong_words:0},{correct_words:0,day:"2024-03-03",wrong_words:0},{correct_words:0,day:"2024-03-02",wrong_words:0},{correct_words:0,day:"2024-03-01",wrong_words:0},{correct_words:0,day:"2024-02-29",wrong_words:0}],status_book:{current_level:1,level_book:[{counts:5262,id:1,name:"4/6级单词",order:1},{counts:1905,id:2,name:"托福核心词汇",order:100},{counts:335,id:3,name:"托福学科词汇",order:101}],level_status:7502,level_total:5262},today_day_review:0,today_day_study:0,total_review:0,total_study:0,vocab:0}),_=l([]),f={new:"学习新单词",old:"复习旧单词"},t=l({payload:{answer:[],correct_answer:[],stem:[],study:!1,target:[],unknown:!1,word:"",word_id:0,word_ids:[],hint:null},is_end:!1,is_answer:!1,is_error:!1}),p=$(!1),w=async()=>{const s=await D(a.userInfo.account_id);o.series=s.series,o.last_day_review=s.last_day_review,o.last_day_study=s.last_day_study,o.today_day_review=s.today_day_review,o.today_day_study=s.today_day_study,o.total_review=s.total_review,o.total_study=s.total_study,o.status_book=s.status_book,o.is_skip_remind=s.is_skip_remind,o.refuse_skip=s.refuse_skip,o.vocab=s.vocab},g=async()=>{const s=await R(a.userInfo.account_id);_.length=0,_.push(...s)},S=async s=>{var c;const e=f[s],r=(c=_.find(u=>u.task_name===e))==null?void 0:c.task_account_id;y.push({name:"wordTask",query:{type:s,id:r}})},x=async()=>{try{const s=Number(d.query.id),{payload:e}=await T(s);t.payload={...e},t.is_answer=!1}catch{y.push("/wordRecite")}},h=s=>{const e=new EventSource(`/ai-api/v1/modelapi/getVocabContent/${s}/`);e.onmessage=function(r){t.payload.response=[...t.payload.response,r.data.replace(/\[DONE!\]/,"")],r.data.match(/\[DONE!\]/)&&(t.is_end=!0,e.close())},e.onerror=function(r){console.error("SSE error:",r),e.close()}},m=async s=>{if(s.endpoints){const{input:e}=s.endpoints.init;s.endpoints.streaming;const{clientId:r}=await q(e);t.is_end=!1,t.payload={...s,response:[]},h(r)}else t.payload={...s},t.is_answer=!1},i=async s=>{try{const e=await v({task_account_id:Number(d.query.id),payload:s});if(e==="finished")p.value=!0;else{const{payload:r}=e;m(r)}}catch(e){console.log(e)}};return{submit_Study:()=>{t.payload.study=!0,t.is_answer=!0,i({payload:t.payload})},vocabs_statics_data:o,vocabs_tasks_data:_,on_jump_vocabs:async s=>{var e;await b({account_id:a.userInfo.account_id,category_id:(e=o.status_book.level_book[s])==null?void 0:e.id}),w()},dialogEvent:async s=>{if(s){const{current_level:e}=o.status_book,r=o.status_book.level_book.findIndex(u=>u.id===e),c=o.status_book.level_book[r+1];c?await b({account_id:a.userInfo.account_id,category_id:c.id}):await k(a.userInfo.account_id)}else await k(a.userInfo.account_id);o.is_skip_remind=null,o.refuse_skip=!0},get_vocabs_statics:w,get_vocabs_tasks:g,start_task:x,to_task:S,aiNext:async()=>{var e;const{payload:s}=await v({task_account_id:Number(d.query.id),payload:{payload:{...t.payload,execute:!0,response:(e=t.payload.response)==null?void 0:e.join("").replaceAll(`
`,"")}}});m(s)},wordTaskData:t,submit_task:async s=>{t.is_error||(t.payload.answer=t.payload.answer.map(()=>0),t.payload.answer[s]=1,t.payload.answer.join("")===t.payload.correct_answer.join("")?(t.is_answer=!0,i({payload:t.payload})):(t.is_error=!0,t.is_answer=!0))},submit_unknown:()=>{t.payload.unknown=!0,t.is_answer=!0,i({payload:t.payload})},finished:p,error_next:()=>{i({payload:t.payload}),t.is_error=!1}}});export{X as u};
