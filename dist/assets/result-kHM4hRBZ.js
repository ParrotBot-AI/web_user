import{ak as _,Y as B,r as H,Q as J,G as F,x as P,am as U}from"./index-qFNGwHMx.js";const ee=l=>_.post("/api/system/microservice/resource/",l),te=l=>_.post("/api/system/microservice/create_mock/",l),oe=l=>_.get(`/api/system/microservice/get_mock/${l}/`),se=l=>_.get(`/api/system/microservice/answer_status/${l}/`),re=l=>_.post("/api/system/microservice/answer_panel/",l),ne=l=>_.post(`/api/system/microservice/submit_answers/${l}/`),T=l=>_.post(`/api/system/microservice/scoring/${l}/`),K=l=>_.get(`/api/system/microservice/get_score/${l}/`),Q=l=>_.get(`/api/system/microservice/get_score_repeat/${l}/`),ae=l=>_.get(`/api/system/microservice/get_past_scores/${l}/`),ce=(l,b)=>_.post("/api/system/microservice/grade_answer/",{sheet_id:l,question_id:b}),ie=l=>_.post("/api/system/microservice/create_mock_sheet/",l),O={27:"A+",25:"A",23:"A-",21:"B+",19:"B",17:"B-",15:"C+",13:"C",10:"C-",0:"F"},R={10:"A+",9:"A",8:"A-","7.5":"B+",7:"B",6:"B-","5.5":"C+",5:"C",4:"C-",0:"F"},V={"Integrated Writing":[{key:"Content & Details Given",title:"内容与细节"},{key:"Grammar",title:"语法"},{key:"Structure/Flow",title:"结构与流畅度"}],"Academic discussion":[{key:"Contribution",title:"内容贡献"},{key:"Relevance",title:"相关性"},{key:"Structure/Flow",title:"结构与流畅度"},{key:"Grammar",title:"语法"}]},Y=[{key:["Fluency","Pronunciation"],title:"流利度"},{key:["Grammar","Vocabulary Usage"],title:"语法与词汇"},{key:"Content",title:"内容"},{key:"Coherence",title:"连贯性"}],$=[{type:"内容",id:"Content",style:{color:"#667085",background:"rgba(253, 212, 78, 0.3)"}},{type:"连贯性",id:"Coherence",style:{color:"#667085","text-decoration-line":"underline","text-decoration-color":"#667085"}},{type:"语法",id:"Grammar and Language Use",style:{color:"#667085","text-decoration-line":"underline","text-decoration-style":"dashed","text-decoration-color":"#C33473"}},{type:"优秀用句",id:"Good",style:{color:"#667085",background:"rgba(183, 217, 114, 0.3)"}}],z=[{type:"内容与细节",id:"Content & Details Given",style:{color:"#667085",background:"rgba(253, 212, 78, 0.3)"}},{type:"结构与流畅度",id:"Structure/Flow",style:{color:"#667085","text-decoration-line":"underline","text-decoration-color":"#667085"}},{type:"语法",id:"Grammar",style:{color:"#667085","text-decoration-line":"underline","text-decoration-style":"dashed","text-decoration-color":"#C33473"}},{type:"优秀用句",id:"Good",style:{color:"#667085",background:"rgba(183, 217, 114, 0.3)"}}],X=[{type:"贡献度与相关性",id:["Contribution","Relevance"],style:{color:"#667085",background:"rgba(253, 212, 78, 0.3)"}},{type:"结构与流畅度",id:"Structure/Flow",style:{color:"#667085","text-decoration-line":"underline","text-decoration-color":"#667085"}},{type:"语法",id:"Grammar",style:{color:"#667085","text-decoration-line":"underline","text-decoration-style":"dashed","text-decoration-color":"#C33473"}},{type:"优秀用句",id:"Good",style:{color:"#667085",background:"rgba(183, 217, 114, 0.3)"}}],le=B("result",()=>{const l=H(!1),b=J(),a=F({loading:!0,title:"",level:"",footerActiveIndex:0,allData:[],aiComment:"",questions_r:{},format_question:[],score_d:[]}),f=F([]),I=t=>t.replace(/TPO\s?\d+/g,""),M=()=>{l.value=!l.value},w=async t=>{await U(5e3),await T(t);const c=await Q(t);c.score===null?w(t):A(c)},G=t=>{const c=t==null?void 0:t.model_answer;if(!c)return{model_answer_content:{},model_answer:""};const s=typeof c=="string"?JSON.parse(c):c;if(s["General Feedback"]){const n=s["General Feedback"].split(/\n?(.+):\s/i).slice(1);s.format_G_F=new Array(n.length/2).fill(0).reduce((o,r,i)=>(o[n[i*2]]=n[i*2+1],o),{})}return s["Mind-Map"]&&(s.format_M_M=s["Mind-Map"].split(/\n/)),{model_answer_content:s,model_answer:c}},C=(t,c)=>{const s=JSON.parse(JSON.stringify(t));return s.forEach(n=>{const o=c==null?void 0:c.filter(r=>n.include.includes(r.name));n.total=0,n.count=0,o==null||o.forEach(r=>{n.total+=r.count,n.count+=r.sum}),n.isComputed=!0}),{list:s,tags:c==null?void 0:c.map(n=>({...n,name:n.name.replace(/^(阅读|听力)/g,"")}))}},N=t=>{const{query:c}=b,s=Object.values(t.score_d);if(c.type==="hearing"){const n=[{title:"基础题",include:["听力目的主旨题","听力内容主旨题","听力细节题"]},{title:"强化题",include:["听力推理题","听力句子功能题","听力连结内容题","听力组织结构题"]}],o=s.map(i=>{const e=i.find(p=>p.name.endsWith("Conversation2")||p.name.endsWith("Lecture3")||p.name.endsWith("Lecture4"))?2:1;return{title:"Section "+e,id:e}});let r=0;return a.allData[0]={layout:"col",name:"听力得分",mockScore:t.score,mockScoreTotal:t.max_score,aiComment:"",list:s.map((i,e)=>{const p=i.reduce((d,m)=>(m.name.includes("Conversation")?d.unshift(m):d.push(m),d),[]);return{...o[e],children:p.map((d,m)=>{var u,g;return{title:d.name.split(/\s/).slice(-1)[0],id:`${e}-${m}`,count:d.count,total:d.total,isComputed:i.score!==null,index:m+e*3,navNum:(g=(u=t.questions_r)==null?void 0:u.questions)==null?void 0:g[m+e*3].children.map(()=>r++)}})}})},a.allData.push(...o.map((i,e)=>{var p,d;return{subtitle:i.title,layout:"row",name:"Raw Score",mockScore:(p=s[e])==null?void 0:p.reduce((m,u)=>m+u.count,0),mockScoreTotal:(d=s[e])==null?void 0:d.reduce((m,u)=>m+u.total,0),...C(n,t.tag_d[e+1]),aiComment:""}})),o}else if(c.type==="spoken"){const n=s[0].map((o,r)=>({title:"Task "+o.name.split(/\s/).slice(-1)[0],id:`${r}`}));return a.allData[0]={layout:"col",name:"口语得分",mockScore:t.questions_r.questions.reduce((o,r)=>o+r.score,0),mockScoreTotal:t.max_score,list:t.questions_r.questions.map((o,r)=>({title:"Task "+o.order,id:r,isComputed:o.score!==null,count:o.score,total:o.max_score}))},a.allData.push(...n.map((o,r)=>{var m;const{model_answer:i,model_answer_content:e}=G(t.questions_r.questions[r]),p=e==null?void 0:e.Content.filter(u=>Object.keys(u).length>0),d=$;return{layout:"col",name:o.title,mockScore:t.questions_r.questions[r].score,mockScoreTotal:t.questions_r.questions[r].max_score,aiComment:(m=e==null?void 0:e.format_G_F)==null?void 0:m.General,model_answer:i,model_answer_content:{...e,sent_back:p.map(u=>Object.keys(u).reduce((g,y)=>{var h;const k=(h=e["Sentence Feedback"][y].Type)==null?void 0:h.reduce((D,q)=>{var S;return{...(S=d.find(x=>x.id===q||x.id.includes(q)))==null?void 0:S.style}},{});return g[y]={...e["Sentence Feedback"][y],original:u[y],style:k,curStyle:{...k},aiStyle:{...k}},g},{}))},question:t.questions_r.questions[r],curIndex:r+1,length:t.questions_r.questions.length,ques_mark:$,list:Y.map(u=>{var y,k;const g=Array.isArray(u.key)?u.key.reduce((h,D)=>{var q;return Number((q=e==null?void 0:e.Grades)==null?void 0:q[D])+h},0):(y=e==null?void 0:e.Grades)==null?void 0:y[u.key];return{title:u.title,count:e?g/2:(k=e==null?void 0:e.Grades)==null?void 0:k[o.key],isComputed:(e==null?void 0:e.Status)==="OK",total:4}})}})),n}else if(c.type==="writing"){const n=s.map((o,r)=>({title:Number(o[0].name.slice(-1))===1?"Integrated Writing":"Academic discussion",id:`${r}`}));return a.allData[0]={layout:"col",name:"写作得分",mockScore:t.score,mockScoreTotal:n.length*15,list:t.questions_r.questions.map((o,r)=>({title:o.keywords.r===1200?"Integrated Writing":"Academic discussion",id:r,isComputed:o.score!==null,count:o.score,total:o.max_score})),aiComment:""},a.allData.push(...n.map((o,r)=>{var m;const{model_answer:i,model_answer_content:e}=G(t.questions_r.questions[r]),p=e==null?void 0:e.Content.filter(u=>Object.keys(u).length>0);console.log(e);const d=o.title==="Integrated Writing"?z:X;return{layout:"col",name:o.title,ques_mark:d,mockScore:t.questions_r.questions[r].score,mockScoreTotal:t.questions_r.questions[r].max_score,aiComment:(m=e==null?void 0:e.format_G_F)==null?void 0:m.General,model_answer:i,model_answer_content:{...e,sent_back:p.map(u=>Object.keys(u).reduce((g,y)=>{var h;const k=(h=e["Sentence Feedback"][y].Type)==null?void 0:h.reduce((D,q)=>{var S;return{...(S=d.find(x=>x.id===q||x.id.includes(q)))==null?void 0:S.style}},{});return g[y]={...e["Sentence Feedback"][y],original:u[y],style:k,curStyle:{...k},aiStyle:{...k}},g},{}))},question:t.questions_r.questions[r],curIndex:r+1,length:t.questions_r.questions.length,list:V[o.title].map(u=>{var g,y;return{title:u.title,count:((g=e==null?void 0:e.Grades)==null?void 0:g[u.key])||0,isComputed:((y=e==null?void 0:e.Grades)==null?void 0:y[u.key])!==null,total:5}})}})),n}else{const n=[{title:"基础题",include:["阅读词汇题","阅读指代题","阅读简化句子题","阅读细节题","阅读排除题"]},{title:"强化题",include:["阅读修辞目的题","阅读插入句子题","阅读推断题"]},{title:"文章小结题",include:["阅读文章内容小结题","阅读表格题"]}],o=s.map((r,i)=>({title:I(r[0].name),id:`${i}`}));return a.allData[0]={layout:"row",name:"模考得分",mockScore:t.score,mockScoreTotal:t.max_score,aiComment:"",...C(n,t.tag_d.all)},a.allData.push(...o.map((r,i)=>{var e,p;return{layout:"row",name:"Raw Score",subtitle:r.title,mockScore:(e=s[i])==null?void 0:e.reduce((d,m)=>d+m.count,0),mockScoreTotal:(p=s[i])==null?void 0:p.reduce((d,m)=>d+m.total,0),aiComment:"",...C(n,t.tag_d[i+1])}})),o}},E=(t,c)=>{const s=Object.keys(t===1?O:R).find(n=>c>=Number(n));return t===1?O[s]:R[s]},A=t=>{console.log("setResultData:::",t),a.questions_r=t.questions_r,a.score_d=Object.values(t.score_d),a.format_question=t.questions_r.questions.reduce((c,s)=>(c.push(...Array.isArray(s.children)&&s.children.length?s.children.map(n=>{var r;const o=(r=s.question_content)==null?void 0:r.split(/\\n/);return{...n,question_parent:{...s,original_question_content:o,question_content:o==null?void 0:o.map(i=>i.replaceAll(s.keywords.k,"")),question_title:s.question_title?s.question_title:"听力原文",children:null}}}):[]),c),[]),f.length=0,f.push({title:"报告",id:"all"},...N(t)),a.title=`${a.score_d[0][0].name.match(/^(TPO\s?\d+)/)[1]} 成绩单`,a.level=E(t.type,t.score),a.loading=!1},j=t=>{const c=[{title:"阅读",id:"reading",layout:"row"},{title:"听力",id:"hearing",layout:"col"},{title:"口语",id:"spoken",layout:"col"},{title:"写作",id:"writing",layout:"table"}];a.questions_r=[],a.score_d=[],a.format_question=[],f.length=0,f[0]={title:"模考",id:"all"},f.push(...c),a.allData[0]={layout:"col",name:"总分",mockScore:t.score,mockScoreTotal:120,aiComment:"",list:c.map((s,n)=>({title:s.title,isComputed:!0,total:t.detail[n].max_score,count:t.detail[n].score}))},a.allData.push(...c.map((s,n)=>({}))),a.loading=!1},L=async t=>{const{query:c}=b;a.title="",a.level="",a.footerActiveIndex=0,a.allData=[],a.aiComment="",a.questions_r={},a.format_question=[],a.score_d=[],a.loading=!0,f.length=0,await T(t);const s=await K(t);if(s.score!==null){if(c.type==="mock"){j(s);return}A(s)}else w(t)},W=P(()=>a.allData[a.footerActiveIndex]);return{getExamResult:L,showHoverMark:(t,c,s,n)=>{var r;((r=a.allData.slice(1)[s])==null?void 0:r.model_answer_content.sent_back).map(i=>{Object.keys(i).map(e=>{n==="hover"?t===e?i[e].curStyle={...i[t].style,"font-weight":"700"}:i[e].curStyle={}:i[e].curStyle=i[e].style})})},curData:W,resultData:a,setShowAnswerHistoryDialog:M,showAnswerHistoryDialog:l,footerData:f}});export{se as a,ne as b,T as c,K as d,re as e,ce as f,ee as g,te as h,ie as i,ae as j,oe as r,le as u};
