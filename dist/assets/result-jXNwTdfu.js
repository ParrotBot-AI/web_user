import{X as y,Y as B,r as N,N as H,C as A,v as P,am as U}from"./index-unOnroCF.js";const v=c=>y.post("/api/system/microservice/resource/",c),ee=c=>y.post("/api/system/microservice/create_mock/",c),te=c=>y.get(`/api/system/microservice/get_mock/${c}`),oe=c=>y.get(`/api/system/microservice/answer_status/${c}/`),re=c=>y.post("/api/system/microservice/answer_panel/",c),se=c=>y.post(`/api/system/microservice/submit_answers/${c}/`),F=c=>y.post(`api/system/microservice/scoring/${c}/`),J=c=>y.get(`api/system/microservice/get_score/${c}/`),K=c=>y.get(`api/system/microservice/get_score_repeat/${c}/`),ae=c=>y.get(`api/system/microservice/get_past_scores/${c}/`),ne=(c,f)=>y.post("api/system/microservice/grade_answer/",{sheet_id:c,question_id:f}),ie=c=>y.post("/api/system/microservice/create_mock_sheet/",c),T={27:"A+",25:"A",23:"A-",21:"B+",19:"B",17:"B-",15:"C+",13:"C",10:"C-",0:"F"},$={10:"A+",9:"A",8:"A-","7.5":"B+",7:"B",6:"B-","5.5":"C+",5:"C",4:"C-",0:"F"},V={"Integrated Writing":[{key:"Content & Details Given",title:"内容与细节"},{key:"Grammar",title:"语法"},{key:"Structure/Flow",title:"结构与流畅度"}],"Academic discussion":[{key:"Contribution",title:"内容贡献"},{key:"Relevance",title:"相关性"},{key:"Structure/Flow",title:"结构与流畅度"},{key:"Grammar",title:"语法"}]},X=[{key:["Fluency","Pronunciation"],title:"流利度"},{key:["Grammar","Vocabulary Usage"],title:"语法与词汇"},{key:"Content",title:"内容"},{key:"Coherence",title:"连贯性"}],O=[{type:"内容",id:"Content",style:{color:"#667085",background:"rgba(253, 212, 78, 0.3)"}},{type:"连贯性",id:"Coherence",style:{color:"#667085","text-decoration-line":"underline","text-decoration-color":"#667085"}},{type:"语法",id:"Grammar and Language Use",style:{color:"#667085","text-decoration-line":"underline","text-decoration-style":"dashed","text-decoration-color":"#C33473"}},{type:"优秀用句",id:"Good",style:{color:"#667085",background:"rgba(183, 217, 114, 0.3)"}}],Y=[{type:"内容与细节",id:"Content & Details Given",style:{color:"#667085",background:"rgba(253, 212, 78, 0.3)"}},{type:"结构与流畅度",id:"Structure/Flow",style:{color:"#667085","text-decoration-line":"underline","text-decoration-color":"#667085"}},{type:"语法",id:"Grammar",style:{color:"#667085","text-decoration-line":"underline","text-decoration-style":"dashed","text-decoration-color":"#C33473"}},{type:"优秀用句",id:"Good",style:{color:"#667085",background:"rgba(183, 217, 114, 0.3)"}}],z=[{type:"贡献度与相关性",id:["Contribution","Relevance"],style:{color:"#667085",background:"rgba(253, 212, 78, 0.3)"}},{type:"结构与流畅度",id:"Structure/Flow",style:{color:"#667085","text-decoration-line":"underline","text-decoration-color":"#667085"}},{type:"语法",id:"Grammar",style:{color:"#667085","text-decoration-line":"underline","text-decoration-style":"dashed","text-decoration-color":"#C33473"}},{type:"优秀用句",id:"Good",style:{color:"#667085",background:"rgba(183, 217, 114, 0.3)"}}],ce=B("result",()=>{const c=N(!1),{query:f}=H(),n=A({loading:!0,title:"",level:"",footerActiveIndex:0,allData:[],aiComment:"",questions_r:{},format_question:[],score_d:[]}),x=A([]),R=t=>t.replace(/TPO\s?\d+/g,""),I=()=>{c.value=!c.value},D=async t=>{await U(5e3),await F(t);const a=await K(t);a.score===null?D(t):G(a)},w=t=>{const a=t==null?void 0:t.model_answer;if(!a)return{model_answer_content:{},model_answer:""};const s=typeof a=="string"?JSON.parse(a):a;if(s["General Feedback"]){const o=s["General Feedback"].split(/\n?(.+):\s/i).slice(1);s.format_G_F=new Array(o.length/2).fill(0).reduce((r,i,e)=>(r[o[e*2]]=o[e*2+1],r),{})}return s["Mind-Map"]&&(s.format_M_M=s["Mind-Map"].split(/\n/)),{model_answer_content:s,model_answer:a}},h=(t,a)=>(t.forEach(s=>{var o,r;s.total=(o=a.filter(i=>s.include.includes(i.name)))==null?void 0:o.reduce((i,e)=>i+e.count||0,0),s.count=(r=a.filter(i=>s.include.includes(i.name)))==null?void 0:r.reduce((i,e)=>i+e.sum||0,0),s.isComputed=!0}),{list:t,tags:a.map(s=>({...s,name:s.name.replace(/^(阅读|听力)/g,"")}))}),M=t=>{const a=Object.values(t.score_d);if(f.type==="hearing"){const s=[{title:"基础题",include:["听力目的主旨题","听力内容主旨题","听力细节题"]},{title:"强化题",include:["听力推理题","听力句子功能题","听力连结内容题","听力组织结构题"]}],o=a.map(r=>{const i=r.find(e=>e.name.endsWith("Conversation2")||e.name.endsWith("Lecture3")||e.name.endsWith("Lecture4"))?2:1;return{title:"Section "+i,id:i}});return n.allData[0]={layout:"col",name:"听力得分",mockScore:t.score,mockScoreTotal:t.max_score,aiComment:"",list:a.map((r,i)=>({...o[i],children:r.map((e,u)=>({title:e.name.split(/\s/).slice(-1)[0],id:`${i}-${u}`,count:e.count,total:e.total,isComputed:r.score!==null}))}))},n.allData.push(...o.map((r,i)=>{var e,u;return{subtitle:r.title,layout:"row",name:"Raw Score",mockScore:(e=a[i])==null?void 0:e.reduce((d,m)=>d+m.count,0),mockScoreTotal:(u=a[i])==null?void 0:u.reduce((d,m)=>d+m.total,0),...h(s,t.tag_d[r.id]),aiComment:""}})),o}else if(f.type==="spoken"){const s=a[0].map((o,r)=>({title:"Task "+o.name.split(/\s/).slice(-1)[0],id:`${r}`}));return n.allData[0]={layout:"col",name:"口语得分",mockScore:t.questions_r.questions.reduce((o,r)=>o+r.score,0),mockScoreTotal:t.max_score,list:t.questions_r.questions.map((o,r)=>({title:"Task "+o.order,id:r,isComputed:o.score!==null,count:o.score,total:o.max_score}))},n.allData.push(...s.map((o,r)=>{var m;const{model_answer:i,model_answer_content:e}=w(t.questions_r.questions[r]),u=e==null?void 0:e.Content.filter(l=>Object.keys(l).length>0),d=O;return{layout:"col",name:o.title,mockScore:t.questions_r.questions[r].score,mockScoreTotal:t.questions_r.questions[r].max_score,aiComment:(m=e==null?void 0:e.format_G_F)==null?void 0:m.General,model_answer:i,model_answer_content:{...e,sent_back:u.map(l=>Object.keys(l).reduce((k,p)=>{var q;const _=(q=e["Sentence Feedback"][p].Type)==null?void 0:q.reduce((C,g)=>{var b;return{...(b=d.find(S=>S.id===g||S.id.includes(g)))==null?void 0:b.style}},{});return k[p]={...e["Sentence Feedback"][p],original:l[p],style:_,curStyle:{..._},aiStyle:{..._}},k},{}))},question:t.questions_r.questions[r],curIndex:r+1,length:t.questions_r.questions.length,ques_mark:O,list:X.map(l=>{var p,_;const k=Array.isArray(l.key)?l.key.reduce((q,C)=>{var g;return Number((g=e==null?void 0:e.Grades)==null?void 0:g[C])+q},0):(p=e==null?void 0:e.Grades)==null?void 0:p[l.key];return{title:l.title,count:e?(k/2).toFixed(1):(_=e==null?void 0:e.Grades)==null?void 0:_[o.key],isComputed:(e==null?void 0:e.Status)==="OK",total:4}})}})),s}else if(f.type==="writing"){const s=a.map((o,r)=>({title:Number(o[0].name.slice(-1))===1?"Integrated Writing":"Academic discussion",id:`${r}`}));return n.allData[0]={layout:"col",name:"写作得分",mockScore:t.questions_r.questions.reduce((o,r)=>o+r.score,0),mockScoreTotal:t.max_score,list:t.questions_r.questions.map((o,r)=>({title:o.keywords.r===1200?"Integrated Writing":"Academic discussion",id:r,isComputed:o.score!==null,count:o.score,total:o.max_score})),aiComment:""},n.allData.push(...s.map((o,r)=>{var m;const{model_answer:i,model_answer_content:e}=w(t.questions_r.questions[r]),u=e==null?void 0:e.Content.filter(l=>Object.keys(l).length>0),d=o.title==="Integrated Writing"?Y:z;return console.log(e),{layout:"col",name:o.title,ques_mark:d,mockScore:t.questions_r.questions[r].score,mockScoreTotal:t.questions_r.questions[r].max_score,aiComment:(m=e==null?void 0:e.format_G_F)==null?void 0:m.General,model_answer:i,model_answer_content:{...e,sent_back:u.map(l=>Object.keys(l).reduce((k,p)=>{var q;const _=(q=e["Sentence Feedback"][p].Type)==null?void 0:q.reduce((C,g)=>{var b;return{...(b=d.find(S=>S.id===g||S.id.includes(g)))==null?void 0:b.style}},{});return k[p]={...e["Sentence Feedback"][p],original:l[p],style:_,curStyle:{..._},aiStyle:{..._}},k},{}))},question:t.questions_r.questions[r],curIndex:r+1,length:t.questions_r.questions.length,list:V[o.title].map(l=>({title:l.title,count:(e==null?void 0:e.Grades[l.key])||0,isComputed:(e==null?void 0:e.Grades[l.key])!==null,total:5}))}})),s}else{const s=[{title:"基础题",include:["阅读词汇题","阅读指代题","句子简化题","阅读细节题","阅读排除题"]},{title:"强化题",include:["阅读修辞目的题","阅读插入句子题","阅读推断题"]},{title:"文章小结题",include:["阅读文章内容小结题","阅读表格题"]}],o=a.map((r,i)=>({title:R(r[0].name),id:`${i}`}));return n.allData[0]={layout:"row",name:"阅读得分",mockScore:t.score,mockScoreTotal:t.max_score,aiComment:"",...h(s,t.tag_d.all)},n.allData.push(...o.map((r,i)=>{var e,u;return{layout:"row",name:"模考得分",subtitle:r.title,mockScore:(e=a[i])==null?void 0:e.reduce((d,m)=>d+m.count,0),mockScoreTotal:(u=a[i])==null?void 0:u.reduce((d,m)=>d+m.total,0),aiComment:"",...h(s,t.tag_d[r.id*1+1])}})),o}},j=(t,a)=>{const s=Object.keys(t===1?T:$).find(o=>a>=Number(o));return t===1?T[s]:$[s]},G=t=>{n.questions_r=t.questions_r,n.score_d=Object.values(t.score_d),n.format_question=t.questions_r.questions.reduce((a,s)=>(a.push(...Array.isArray(s.children)&&s.children.length?s.children.map(o=>{var i;const r=(i=s.question_content)==null?void 0:i.split(/\\n/);return{...o,question_parent:{...s,original_question_content:r,question_content:r==null?void 0:r.map(e=>e.replaceAll(s.keywords.k,"")),question_title:s.question_title?s.question_title:"听力原文",children:null}}}):[]),a),[]),x.length=0,x.push({title:"报告",id:"all"},...M(t)),n.title=`${n.score_d[0][0].name.match(/^(TPO\s?\d+)/)[1]} 成绩单`,n.level=j(t.type,t.score),n.loading=!1},E=t=>{const a=[{title:"阅读",id:"reading",layout:"row"},{title:"听力",id:"hearing",layout:"col"},{title:"口语",id:"spoken",layout:"col"},{title:"写作",id:"writing",layout:"table"}];console.log(t),n.questions_r=[],n.score_d=[],n.format_question=[],x.length=0,x[0]={title:"模考",id:"all"},x.push(...a),n.allData[0]={layout:"col",name:"总分",mockScore:t.score,mockScoreTotal:120,aiComment:"",list:a.map((s,o)=>({title:s.title,isComputed:!0,total:t.detail[o].max_score,count:t.detail[o].score}))},n.allData.push(...a.map((s,o)=>({}))),n.loading=!1},L=async t=>{n.title="",n.level="",n.footerActiveIndex=0,n.allData=[],n.aiComment="",n.questions_r={},n.format_question=[],n.score_d=[],n.loading=!0,await F(t);const a=await J(t);if(a.score!==null){if(f.type==="mock"){E(a);return}G(a)}else D(t)},W=P(()=>n.allData[n.footerActiveIndex]);return{getExamResult:L,showHoverMark:(t,a,s,o)=>{var i;((i=n.allData.slice(1)[s])==null?void 0:i.model_answer_content.sent_back).map(e=>{Object.keys(e).map(u=>{o==="hover"?t===u?e[u].curStyle={...e[t].style,"font-weight":"700"}:e[u].curStyle={}:e[u].curStyle=e[u].style})})},curData:W,resultData:n,setShowAnswerHistoryDialog:I,showAnswerHistoryDialog:c,footerData:x}});export{oe as a,se as b,F as c,J as d,re as e,ne as f,v as g,ee as h,ie as i,ae as j,te as r,ce as u};
