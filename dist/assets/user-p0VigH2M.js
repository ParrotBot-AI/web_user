import{Y as y,r as d,G as h,q as I,ac as q,D as t,ad as x,ae as S,af as w,ab as _,ag as b,ah as P,ai as U,aj as C}from"./index-5iyNLtEq.js";const j=y("user",()=>{const i=d("code"),c=h([]),u=d(""),n=h([]),r=I(),l=s=>{i.value=s},f=async(s,e)=>{try{await q({phone:s,type:1})}catch{t.error("获取验证码失败"),e()}},m=async(s,e)=>{const a=await x(s);S("userinfo",a,null),w("usermenu"),w("userdata"),e&&(e!=null&&e.password)&&await p({code:s.code,mobile:s.mobile,password:e.password}),t.success("登录成功",1,()=>{a.name?_.push("/home"):_.push("/welcome")})},p=async s=>{await b(r.userInfo.userId,{code:s.code,phone:s.mobile,newPassword:s.password,newPassword2:s.password}),t.success("修改密码成功")};return{onClickChangeLoginType:l,loginType:i,api_sms:f,api_login:m,api_findPassword:p,api_out:async()=>{await U(),window.localStorage.clear()},api_setUserInfo:async(s,e)=>{await P(s,e)},api_checkin:async()=>{const s=r.userInfo.account_id,{charts:e,current:a,daka:g,info:k}=await C(s);c.length=0,c.push(...e),u.value=a,n.length=0,n.push(...g.map(o=>({...o,class:o.lock?"lock":o.count_process>=o.count_target?"success":o.date===a?"today":"fail"}))),r.userTargets.forEach(o=>{o.val=k[o.id]})},homeCharts:c,homeDate:u,homeDaka:n}});export{j as u};
