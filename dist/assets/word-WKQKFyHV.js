import{s as q}from"./ai-N-XgvB8W.js";import{ak as n,Z as j,q as I,k as E,S as N,J as y,r as $,G as D}from"./index-ws_RMIfo.js";const R=a=>n.get(`api/system/microservice/get_vocabs_statics/${a}/`),T=a=>n.get(`api/system/microservice/get_vocabs_tasks/${a}/`),A=a=>n.post("api/system/microservice/start_task/",{task_account_id:a}),v=a=>n.post("api/system/microservice/learning_task/",a),k=a=>n.post(`api/system/microservice/refuse_jump_vocabs/${a}/`),f=a=>n.post("/api/system/microservice/jump_vocabs/",a),Y=j("word",()=>{const a=I(),i=E(),d=N(),o=y({is_skip_remind:null,last_day_review:0,last_day_study:0,series:[{correct_words:0,day:"2024-03-04",wrong_words:0},{correct_words:0,day:"2024-03-03",wrong_words:0},{correct_words:0,day:"2024-03-02",wrong_words:0},{correct_words:0,day:"2024-03-01",wrong_words:0},{correct_words:0,day:"2024-02-29",wrong_words:0}],status_book:{current_level:1,level_book:[{counts:5262,id:1,name:"4/6级单词",order:1},{counts:1905,id:2,name:"托福核心词汇",order:100},{counts:335,id:3,name:"托福学科词汇",order:101}],level_status:7502,level_total:5262},today_day_review:0,today_day_study:0,total_review:0,total_study:0,vocab:0}),_=y([]),b={new:"学习新单词",old:"复习旧单词"},e=y({payload:{answer:[],correct_answer:[],stem:[],study:!1,target:[],unknown:!1,word:"",word_id:0,word_ids:[],hint:null},is_end:!1,is_answer:!1,is_error:!1}),p=$(!1),w=async()=>{const s=await R(a.userInfo.account_id);o.series=s.series,o.last_day_review=s.last_day_review,o.last_day_study=s.last_day_study,o.today_day_review=s.today_day_review,o.today_day_study=s.today_day_study,o.total_review=s.total_review,o.total_study=s.total_study,o.status_book=s.status_book,o.is_skip_remind=s.is_skip_remind,o.refuse_skip=s.refuse_skip,o.vocab=s.vocab},g=async()=>{const s=await T(a.userInfo.account_id);_.length=0,_.push(...s)},S=async s=>{var c;const t=b[s],r=(c=_.find(l=>l.task_name===t))==null?void 0:c.task_account_id;i.push({name:"wordTask",query:{type:s,id:r}})},x=async()=>{try{const s=Number(d.query.id);if(s){const{payload:t}=await A(s);e.payload={...t},e.is_answer=!1}else D.warning("今日任务已完成"),i.push("/wordRecite")}catch{i.push("/wordRecite")}},h=s=>{const t=new EventSource(`/ai-api/v1/modelapi/getVocabContent/${s}/`);t.onmessage=function(r){e.payload.response=[...e.payload.response,r.data.replace(/\[DONE!\]/,"")],r.data.match(/\[DONE!\]/)&&(e.is_end=!0,t.close())},t.onerror=function(r){console.error("SSE error:",r),t.close()}},m=async s=>{if(s.endpoints){const{input:t}=s.endpoints.init;s.endpoints.streaming;const{clientId:r}=await q(t);e.is_end=!1,e.payload={...s,response:[]},h(r)}else e.payload={...s},e.is_answer=!1},u=async s=>{try{const t=await v({task_account_id:Number(d.query.id),payload:s});if(t==="finished")p.value=!0;else{const{payload:r}=t;m(r)}}catch(t){console.log(t)}};return{submit_Study:()=>{var s;e.payload.execute=!0,e.payload.study=!0,e.payload.response=(s=e.payload.response)==null?void 0:s.join("").replaceAll(`
`,""),e.is_answer=!0,u({payload:e.payload})},vocabs_statics_data:o,vocabs_tasks_data:_,on_jump_vocabs:async s=>{var t;await f({account_id:a.userInfo.account_id,category_id:(t=o.status_book.level_book[s])==null?void 0:t.id}),w()},dialogEvent:async s=>{if(s){const{current_level:t}=o.status_book,r=o.status_book.level_book.findIndex(l=>l.id===t),c=o.status_book.level_book[r+1];c?await f({account_id:a.userInfo.account_id,category_id:c.id}):await k(a.userInfo.account_id)}else await k(a.userInfo.account_id);o.is_skip_remind=null,o.refuse_skip=!0},get_vocabs_statics:w,get_vocabs_tasks:g,start_task:x,to_task:S,aiNext:async()=>{var t;const{payload:s}=await v({task_account_id:Number(d.query.id),payload:{payload:{...e.payload,execute:!0,response:(t=e.payload.response)==null?void 0:t.join("").replaceAll(`
`,"")}}});m(s)},wordTaskData:e,submit_task:async s=>{e.is_error||(e.payload.answer=e.payload.answer.map(()=>0),e.payload.answer[s]=1,e.payload.answer.join("")===e.payload.correct_answer.join("")?(e.is_answer=!0,u({payload:e.payload})):(e.is_error=!0,e.is_answer=!0))},submit_unknown:()=>{e.payload.unknown=!0,e.is_answer=!0,e.is_error=!0},finished:p,error_next:()=>{u({payload:e.payload}),e.is_error=!1}}});export{A as r,Y as u};
