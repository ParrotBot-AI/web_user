import{u as $,g as M,h as N,i as W,r as H,a as Q,e as j,b as z,c as S,d as k,j as V}from"./result-7MSJ7k2m.js";import{X,r as w,N as Y,H as B,D as _,p as F,v as I,Y as G}from"./index-PocizONO.js";const se=X("exam",()=>{const g=w(!1),C=w(!1),o=Y(),m=B();$();const c=_({allList:[],list:[],total:0,pageArr:[{start:1,end:20,id:0}]}),t=_({curQuestionIndex:1,curIndex:0,childrenLength:0,curQuestionChildrenIndex:0,time_remain:0,sheet_id:"0",questions:[],answerData:[],type:0}),u=_({writing:{},spoken:{},hear:{},read:{},isEmpty:!0}),D=["read","spoken","hearing","writing"],q=w(""),p=_([]),h=F(),l=20,L=_({read:{remark:"Passage",height:184,promptText:"为适应新版托福形式变更，阅读模考需要从三篇中选择两篇.",maxSelectCount:2,minSelectCount:1},hearing:{remark:"Lecture",height:326,promptText:"为适应新版托福形式变更，听力模考section2需要选择1篇lecture",maxSelectCount:1,minSelectCount:1},spoken:{remark:"Task",height:249,promptText:"",maxSelectCount:4,minSelectCount:4},writing:{remark:["Integrated Writing","Academic discussion"],height:184,promptText:"",maxSelectCount:2,minSelectCount:2},mock:{height:249,remark:["Reading","Listening","Speaking","Writing"]}}),R=async(n,e)=>{const a=h.menuData.list,{pattern_id:s,name:r}=a.find(i=>i.key===o.name);if(e){q.value=r,c.pageArr=[];const i=await M({exam_id:1,pattern_id:s||"",limit:l,account_id:h.userInfo.account_id,page:n+1,whether_zt:!1});c.allList=o.name==="mock"?i.data[0].children:i.data,c.total=o.name==="mock"?c.allList.length:i.total,c.pageArr=new Array(Math.ceil(c.total/l)).fill(0).map((d,x)=>({start:x*l+1,end:Math.min((x+1)*l,c.total),id:x}))}c.list=c.allList.slice(n*l,(n+1)*l)},f=async(n,e,a)=>{const s=h.userInfo.account_id,r={q_type:n,question_ids:e,account_id:s};a&&(r.father_sheet=a);const i=await N(r);return t.sheet_id=i.sheet_id,i},b=async(n,e,a)=>{const s=h.userInfo.account_id;return await W({q_type:n,question_ids:e,account_id:s,father_sheet:a})},v=async(n,e)=>{try{t.curIndex=0,t.curQuestionIndex=0,t.curQuestionChildrenIndex=0,t.time_remain=0,t.sheet_id="",t.questions=[],t.answerData=[],t.type=0;const[a,s]=await Promise.all([H(n),Q(n)]);t.answerData=s.map(r=>({is_answer:r.is_answer,question_id:r.question_id,answer:r.answer})),t.sheet_id=a.sheet_id,t.childrenLength=a.questions.reduce((r,i)=>r+i.children.length,0),e?(t.curQuestionIndex=Number(o.query.sectionIndex)||0,t.curQuestionChildrenIndex=Number(o.query.quesIndex)||0,t.curIndex=a.questions.slice(0,t.curQuestionIndex).reduce((r,i)=>{var d;return r+((d=i==null?void 0:i.children)==null?void 0:d.length)||0},0)+t.curQuestionChildrenIndex):(t.curQuestionIndex=0,t.curQuestionChildrenIndex=0,t.curIndex=0),t.time_remain=a.time_remain,t.questions=a.questions,t.type=a.type}catch{m.back()}},P=n=>{let e=t.curIndex+n;const a=t.childrenLength;e<=0&&(e=0),e===a&&(e=a-1);let s=0,r=0;t.questions.forEach((i,d)=>{const x=i.children,E=s+x.length;e>=s&&e<=E&&(r=d),s=E}),t.curIndex=e,t.curQuestionIndex=r,t.curQuestionChildrenIndex=r>0?e-t.questions.slice(0,r).reduce((i,d)=>i+d.children.length,0):e,m.replace({query:{...o.query,sectionIndex:t.curQuestionIndex,quesIndex:t.curQuestionChildrenIndex}})},T=I(()=>t.curIndex===t.childrenLength-1),y=I(()=>{var e;const n=t.questions[t.curQuestionIndex];if(n&&n.question_content&&n.children.length>0){let a=0;const s=(e=n.question_content)==null?void 0:e.replace(/\$\$/g,()=>`<span class="fill-item" data-index="${a++}">【 <b></b> 】</span>`);return{...n,cur_questions_content:s.split(/\\n/)}}return{children:[],question_content:"",question_title:"",cur_questions_content:""}}),A=I(()=>{var e;const n=(e=y.value)==null?void 0:e.children[t.curQuestionChildrenIndex];return n?{...n,isShowViewText:n.question_type==="Toefl_Reading_mc"}:null});return{types:D,getExamProcess:async n=>{try{const e=await Q(n);p.length=0,p.push(...e)}catch(e){console.log(e)}},startMixedExam:b,getPastResult:async()=>{const n=h.userInfo.account_id,e=await V(n);e.听力&&e.写作&&e.口语&&e.阅读?(u.hear=e.听力,u.writing=e.写作,u.spoken=e.口语,u.read=e.阅读,u.isEmpty=!1):u.isEmpty=!0},processData:p,pastScores:u,setShowProcessDialog:()=>{g.value=!g.value},showAnswerHistoryDialog:C,showProcessDialog:g,getExamResource:R,exam_data:c,startExam:f,examing_data:t,changeQuestion:P,curQuestion:y,curQuestionChildren:A,getExamData:v,saveQuestion:async(n,e)=>{const a=t.answerData.findIndex(s=>s.question_id===n);t.answerData[a]={question_id:n,is_answer:!0,answer:e},await j({sheet_id:t.sheet_id,question_id:n,answer:e,duration:0})},isExamEnding:T,requestSubmitExam:async n=>{var r;await z(n);const{query:e,name:a}=o,s=G(`mixedExam-${e==null?void 0:e.mid}`);if((e==null?void 0:e.type)==="mixedExam"&&(e!=null&&e.mid)){a==="spokenExam"?(await S(n),await k(n),await f("mock_exam",s==null?void 0:s.quesid[3],s==null?void 0:s.father_sheet),m.push({name:"writingExam",query:{type:"mixedExam",mid:s==null?void 0:s.father_sheet,name:s.resource_name,id:t.sheet_id}})):a==="writingExam"&&(await S(n),await k(n),m.push(`/result/${s==null?void 0:s.father_sheet}?type=mock`));return}m.push(`/result/${n}?type=${(r=o==null?void 0:o.meta)==null?void 0:r.parent}`)},questionTitle:q,customData:L}});export{se as u};
