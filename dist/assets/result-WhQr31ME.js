import{ak as f,Y as K,r as P,Q,G as M,x as U,am as V,M as Y}from"./index-5iyNLtEq.js";const rt=l=>f.post("/api/system/microservice/resource/",l),at=l=>f.post("/api/system/microservice/create_mock/",l),nt=l=>f.get(`/api/system/microservice/get_mock/${l}/`),it=l=>f.get(`/api/system/microservice/answer_status/${l}/`),ct=l=>f.post("/api/system/microservice/answer_panel/",l),lt=l=>f.post(`/api/system/microservice/submit_answers/${l}/`),v=l=>f.post(`/api/system/microservice/scoring/${l}/`),z=l=>f.get(`/api/system/microservice/get_score/${l}/`),E=l=>f.get(`/api/system/microservice/get_score_repeat/${l}/`),ut=l=>f.get(`/api/system/microservice/get_past_scores/${l}/`),mt=(l,S)=>f.post("/api/system/microservice/grade_answer/",{sheet_id:l,question_id:S}),dt=l=>f.post("/api/system/microservice/create_mock_sheet/",l),N={10:"A+",9:"A",8:"A-","7.5":"B+",7:"B",6:"B-","5.5":"C+",5:"C",4:"C-",0:"F"},X={"Integrated Writing":[{key:"Content & Details Given",title:"å†…å®¹ä¸Žç»†èŠ‚"},{key:"Grammar",title:"è¯­æ³•"},{key:"Structure/Flow",title:"ç»“æž„ä¸Žæµç•…åº¦"}],"Academic discussion":[{key:"Contribution",title:"å†…å®¹è´¡çŒ®"},{key:"Relevance",title:"ç›¸å…³æ€§"},{key:"Structure/Flow",title:"ç»“æž„ä¸Žæµç•…åº¦"},{key:"Grammar",title:"è¯­æ³•"}]},Z=[{key:["Fluency","Pronunciation"],title:"æµåˆ©åº¦"},{key:["Grammar","Vocabulary Usage"],title:"è¯­æ³•ä¸Žè¯æ±‡"},{key:"Content",title:"å†…å®¹"},{key:"Coherence",title:"è¿žè´¯æ€§"}],W=[{type:"å†…å®¹",id:"Content",style:{color:"#667085",background:"rgba(253, 212, 78, 0.3)"}},{type:"è¿žè´¯æ€§",id:"Coherence",style:{color:"#667085","text-decoration-line":"underline","text-decoration-color":"#667085"}},{type:"è¯­æ³•",id:"Grammar and Language Use",style:{color:"#667085","text-decoration-line":"underline","text-decoration-style":"dashed","text-decoration-color":"#C33473"}},{type:"ä¼˜ç§€ç”¨å¥",id:"Good",style:{color:"#667085",background:"rgba(183, 217, 114, 0.3)"}}],tt=[{type:"å†…å®¹ä¸Žç»†èŠ‚",id:"Content & Details Given",style:{color:"#667085",background:"rgba(253, 212, 78, 0.3)"}},{type:"ç»“æž„ä¸Žæµç•…åº¦",id:"Structure/Flow",style:{color:"#667085","text-decoration-line":"underline","text-decoration-color":"#667085"}},{type:"è¯­æ³•",id:"Grammar",style:{color:"#667085","text-decoration-line":"underline","text-decoration-style":"dashed","text-decoration-color":"#C33473"}},{type:"ä¼˜ç§€ç”¨å¥",id:"Good",style:{color:"#667085",background:"rgba(183, 217, 114, 0.3)"}}],et=[{type:"è´¡çŒ®åº¦ä¸Žç›¸å…³æ€§",id:["Contribution","Relevance"],style:{color:"#667085",background:"rgba(253, 212, 78, 0.3)"}},{type:"ç»“æž„ä¸Žæµç•…åº¦",id:"Structure/Flow",style:{color:"#667085","text-decoration-line":"underline","text-decoration-color":"#667085"}},{type:"è¯­æ³•",id:"Grammar",style:{color:"#667085","text-decoration-line":"underline","text-decoration-style":"dashed","text-decoration-color":"#C33473"}},{type:"ä¼˜ç§€ç”¨å¥",id:"Good",style:{color:"#667085",background:"rgba(183, 217, 114, 0.3)"}}],yt=K("result",()=>{const l=P(!1),S=Q(),a=M({loading:!0,title:"",level:"",footerActiveIndex:0,allData:[],type:"",aiComment:"",navData:[],questions_r:{},format_question:[],score_d:[],AnnotationData:[]}),D=M([]),j=t=>t.replace(/TPO\s?\d+/g,""),L=()=>{const{query:t}=S;if(t.type==="mock"){const i=D[a.footerActiveIndex],s=a.allData[a.footerActiveIndex];a.type=i.id,a.format_question=I(s.originData),a.questions_r=s.originData.questions_r,(a.type==="spoken"||a.type==="writing")&&(a.AnnotationData=s.formatAllData.allData.slice(1)),a.type==="hearing"&&(a.navData=s.list)}l.value=!l.value},w=async t=>{await V(5e3),await v(t);const i=await E(t);i.score===null?w(t):$(i)},O=t=>{const i=t==null?void 0:t.model_answer;if(!i)return{model_answer_content:{},model_answer:""};const s=typeof i=="string"?JSON.parse(i):i;if(s["General Feedback"]){const n=s["General Feedback"].split(/\n?(.+):\s/i).slice(1);s.format_G_F=new Array(n.length/2).fill(0).reduce((c,r,o)=>(c[n[o*2]]=n[o*2+1],c),{})}return s["Mind-Map"]&&(s.format_M_M=s["Mind-Map"].split(/\n/)),{model_answer_content:s,model_answer:i}},F=(t,i)=>{const s=JSON.parse(JSON.stringify(t));return s.forEach(n=>{const c=i==null?void 0:i.filter(r=>n.include.includes(r.name));n.total=0,n.count=0,c==null||c.forEach(r=>{n.total+=r.count,n.count+=r.sum}),n.isComputed=!0}),{list:s,tags:i==null?void 0:i.map(n=>({...n,name:n.name.replace(/^(é˜…è¯»|å¬åŠ›)/g,"")}))}},T=(t,i)=>{const s=Object.values(t.score_d);if(i==="hearing"){const n=[{title:"åŸºç¡€é¢˜",include:["å¬åŠ›ç›®çš„ä¸»æ—¨é¢˜","å¬åŠ›å†…å®¹ä¸»æ—¨é¢˜","å¬åŠ›ç»†èŠ‚é¢˜"]},{title:"å¼ºåŒ–é¢˜",include:["å¬åŠ›æŽ¨ç†é¢˜","å¬åŠ›å¥å­åŠŸèƒ½é¢˜","å¬åŠ›è¿žç»“å†…å®¹é¢˜","å¬åŠ›ç»„ç»‡ç»“æž„é¢˜"]}],c=s.map(m=>{const e=m.find(p=>p.name.endsWith("Conversation2")||p.name.endsWith("Lecture3")||p.name.endsWith("Lecture4"))?2:1;return{title:"Section "+e,id:e}});let r=0;const o={layout:"col",name:"å¬åŠ›å¾—åˆ†",mockScore:t.score,mockScoreTotal:t.max_score,level:x(t.score,t.max_score),aiComment:"",list:s.map((m,e)=>{const p=m.reduce((y,u)=>(u.name.includes("Conversation")?y.unshift(u):y.push(u),y),[]);return{...c[e],children:p.map((y,u)=>{var q,d;return{title:y.name.split(/\s/).slice(-1)[0],id:`${e}-${u}`,count:y.count,total:y.total,isComputed:m.score!==null,index:u+e*3,navNum:(d=(q=t.questions_r)==null?void 0:q.questions)==null?void 0:d[u+e*3].children.map(()=>r++)}})}})};return a.navData=o.list,{allData:[o,...c.map((m,e)=>{var u,q;const p=(u=s[e])==null?void 0:u.reduce((d,g)=>d+g.count,0),y=(q=s[e])==null?void 0:q.reduce((d,g)=>d+g.total,0);return{subtitle:m.title,layout:"row",level:x(p,y),name:"Raw Score",mockScore:p,mockScoreTotal:y,...F(n,t.tag_d[e+1]),aiComment:""}})],footerData:c}}else if(i==="spoken"){const n=s[0].map((r,o)=>({title:"Task "+r.name.split(/\s/).slice(-1)[0],id:`${o}`})),c=n.map((r,o)=>{var u,q;const{model_answer:m,model_answer_content:e}=O(t.questions_r.questions[o]),p=(u=e==null?void 0:e.Content)==null?void 0:u.filter(d=>Object.keys(d).length>0),y=W;return{layout:"col",name:r.title,level:x(t.questions_r.questions[o].score,t.questions_r.questions[o].max_score),mockScore:t.questions_r.questions[o].score,mockScoreTotal:t.questions_r.questions[o].max_score,aiComment:(e==null?void 0:e.Status)==="OK"?(q=e==null?void 0:e.format_G_F)==null?void 0:q.General:(e==null?void 0:e.msg)==="ç”¨é‡å·²è¶…ä½¿ç”¨ä¸Šé™åˆ¶"?"ðŸ”’æ‚¨çš„ä»Šæ—¥å…è´¹æ‰¹æ”¹æ¬¡æ•°å·²ç”¨å°½ï¼Œå¦‚éœ€æ‰¹æ”¹ï¼Œè¯·å‰å¾€ä»·æ ¼é¡µè´­ä¹°ã€‚":e==null?void 0:e.msg,model_answer:m,model_answer_content:{...e,sent_back:p.map(d=>Object.keys(d).reduce((g,_)=>{var h;const k=(h=e["Sentence Feedback"][_].Type)==null?void 0:h.reduce((C,b)=>{var A;return{...(A=y.find(G=>G.id===b||G.id.includes(b)))==null?void 0:A.style}},{});return g[_]={...e["Sentence Feedback"][_],original:d[_],style:k,curStyle:{...k},aiStyle:{...k}},g},{}))},question:t.questions_r.questions[o],curIndex:o+1,length:t.questions_r.questions.length,ques_mark:W,list:Z.map(d=>{var _,k;const g=Array.isArray(d.key)?d.key.reduce((h,C)=>{var b;return Number((b=e==null?void 0:e.Grades)==null?void 0:b[C])+h},0):(_=e==null?void 0:e.Grades)==null?void 0:_[d.key];return{title:d.title,count:e?g/2:(k=e==null?void 0:e.Grades)==null?void 0:k[r.key],isComputed:(e==null?void 0:e.Status)==="OK",total:4}})}});return a.AnnotationData=c,{allData:[{layout:"col",name:"å£è¯­å¾—åˆ†",level:x(t.score,n.length===4?30:t==null?void 0:t.max_score),mockScore:t==null?void 0:t.score,mockScoreTotal:n.length===4?30:t==null?void 0:t.max_score,list:t.questions_r.questions.map((r,o)=>({title:"Task "+r.order,id:o,isComputed:r.score!==null,count:r.score,total:r.max_score}))},...c],footerData:n}}else if(i==="writing"){const n=s.map((r,o)=>({title:Number(r[0].name.slice(-1))===1?"Integrated Writing":"Academic discussion",id:`${o}`})),c=n.map((r,o)=>{var u,q,d;const{model_answer:m,model_answer_content:e}=O(t.questions_r.questions[o]),p=(q=(u=e==null?void 0:e.Content)==null?void 0:u.filter)==null?void 0:q.call(u,g=>Object.keys(g).length>0),y=r.title==="Integrated Writing"?tt:et;return{layout:"col",name:r.title,ques_mark:y,mockScore:t.questions_r.questions[o].score,mockScoreTotal:t.questions_r.questions[o].max_score,level:x(t.questions_r.questions[o].score,t.questions_r.questions[o].max_score),aiComment:(e==null?void 0:e.Status)==="OK"?(d=e==null?void 0:e.format_G_F)==null?void 0:d.General:(e==null?void 0:e.msg)==="ç”¨é‡å·²è¶…ä½¿ç”¨ä¸Šé™åˆ¶"?"ðŸ”’æ‚¨çš„ä»Šæ—¥å…è´¹æ‰¹æ”¹æ¬¡æ•°å·²ç”¨å°½ï¼Œå¦‚éœ€æ‰¹æ”¹ï¼Œè¯·å‰å¾€ä»·æ ¼é¡µè´­ä¹°ã€‚":e==null?void 0:e.msg,model_answer:m,model_answer_content:{...e,sent_back:p==null?void 0:p.map(g=>Object.keys(g).reduce((_,k)=>{var C;const h=(C=e["Sentence Feedback"][k].Type)==null?void 0:C.reduce((b,A)=>{var G;return{...(G=y.find(R=>R.id===A||R.id.includes(A)))==null?void 0:G.style}},{});return _[k]={...e["Sentence Feedback"][k],original:g[k],style:h,curStyle:{...h},aiStyle:{...h}},_},{}))},question:t.questions_r.questions[o],curIndex:o+1,length:t.questions_r.questions.length,list:X[r.title].map(g=>{var _,k;return{title:g.title,count:((_=e==null?void 0:e.Grades)==null?void 0:_[g.key])||0,isComputed:((k=e==null?void 0:e.Grades)==null?void 0:k[g.key])!==null,total:5}})}});return a.AnnotationData=c,{footerData:n,allData:[{layout:"col",name:"å†™ä½œå¾—åˆ†",mockScore:t.score,mockScoreTotal:n.length*15,level:x(t.score,n.length*15),list:t.questions_r.questions.map((r,o)=>({title:r.keywords.r===1200?"Integrated Writing":"Academic discussion",id:o,isComputed:r.score!==null,count:r.score,total:r.max_score})),aiComment:""},...c]}}else{const n=[{title:"åŸºç¡€é¢˜",include:["é˜…è¯»è¯æ±‡é¢˜","é˜…è¯»æŒ‡ä»£é¢˜","é˜…è¯»ç®€åŒ–å¥å­é¢˜","é˜…è¯»ç»†èŠ‚é¢˜","é˜…è¯»æŽ’é™¤é¢˜"]},{title:"å¼ºåŒ–é¢˜",include:["é˜…è¯»ä¿®è¾žç›®çš„é¢˜","é˜…è¯»æ’å…¥å¥å­é¢˜","é˜…è¯»æŽ¨æ–­é¢˜"]},{title:"æ–‡ç« å°ç»“é¢˜",include:["é˜…è¯»æ–‡ç« å†…å®¹å°ç»“é¢˜","é˜…è¯»è¡¨æ ¼é¢˜"]}],c=s.map((r,o)=>({title:j(r[0].name),id:`${o}`}));return{footerData:c,allData:[{layout:"row",name:"é˜…è¯»å¾—åˆ†",mockScore:t.score,mockScoreTotal:t.max_score,level:x(t.score,t.max_score),aiComment:"",...F(n,t.tag_d.all)},...c.map((r,o)=>{var p,y;const m=(p=s[o])==null?void 0:p.reduce((u,q)=>u+q.count,0),e=(y=s[o])==null?void 0:y.reduce((u,q)=>u+q.total,0);return{layout:"row",name:"Raw Score",subtitle:r.title,mockScore:m,mockScoreTotal:e,level:x(m,e),aiComment:"",...F(n,t.tag_d[o+1])}})]}}},x=(t,i)=>{const s=t*(10/i),n=Object.keys(N).sort((r,o)=>r-o),c=n.find((r,o)=>s>=Number(r)&&s<Number(o===n.length-1?11:n[o+1]),0);return N[c]},I=t=>t.questions_r.questions.reduce((i,s)=>(i.push(...Array.isArray(s.children)&&s.children.length?s.children.map(n=>{var r;const c=(r=s.question_content)==null?void 0:r.split(/\\n/);return{...n,question_parent:{...s,original_question_content:c,question_content:c==null?void 0:c.map(o=>o.replaceAll(s.keywords.k,"")),question_title:s.question_title?s.question_title:"å¬åŠ›åŽŸæ–‡",children:null}}}):[]),i),[]),$=t=>{a.questions_r=t.questions_r,a.score_d=Object.values(t.score_d);const{query:i}=S;a.type=i.type,a.format_question=I(t),D.length=0;const s=T(t,i.type);D.push({title:"æŠ¥å‘Š",id:"all"},...s.footerData),a.allData=s.allData,a.title=`${a.score_d[0][0].name.match(/^(TPO\s?\d+)/)[1]} æˆç»©å•`,a.loading=!1},H=async t=>{var n;const{params:i}=S,s=[{title:"é˜…è¯»",id:"read",layout:"row"},{title:"å¬åŠ›",id:"hearing",layout:"col"},{title:"å£è¯­",id:"spoken",layout:"col"},{title:"å†™ä½œ",id:"writing",layout:"table"}];a.questions_r=[],a.score_d=[],a.format_question=[],D.length=0,D[0]={title:"æ¨¡è€ƒ",id:"MixedAll"},D.push(...s),a.allData[0]={layout:"col",name:"æ€»åˆ†",mockScore:t.score,mockScoreTotal:120,level:x(t.score,120),aiComment:"",list:s.map((c,r)=>({title:c.title,isComputed:!0,total:t.detail[r].max_score,count:t.detail[r].score}))};for(let c=0;c<s.length;c++){const r=await E(t.detail[c].sheet_id),o=T(r,s[c].id);a.allData.push({...o.allData[0],formatAllData:o,originData:r})}a.title=((n=Y("mixedExam-"+i.sheetId))==null?void 0:n.resource_name)||"æ¨¡è€ƒæˆç»©å•",a.loading=!1},B=async t=>{const{query:i}=S;a.title="",a.level="",a.footerActiveIndex=0,a.allData=[],a.aiComment="",a.questions_r={},a.format_question=[],a.score_d=[],a.loading=!0,D.length=0,await v(t);const s=await z(t);if(s.score!==null){if(i.type==="mock"){H(s);return}$(s)}else w(t)},J=U(()=>a.allData[a.footerActiveIndex]);return{getExamResult:B,showHoverMark:(t,i,s,n)=>{var r;((r=a.allData.slice(1)[s])==null?void 0:r.model_answer_content.sent_back).map(o=>{Object.keys(o).map(m=>{n==="hover"?t===m?o[m].curStyle={...o[t].style,"font-weight":"700"}:o[m].curStyle={}:o[m].curStyle=o[m].style})})},curData:J,resultData:a,setShowAnswerHistoryDialog:L,showAnswerHistoryDialog:l,footerData:D}});export{it as a,lt as b,v as c,z as d,ct as e,mt as f,rt as g,at as h,dt as i,ut as j,nt as r,yt as u};
