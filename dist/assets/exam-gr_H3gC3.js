import{M as T,r as I,N as A,G as $,C as x,p as M,v as q,_ as N}from"./index-nx37jhkW.js";import{h as W,i as j,j as z,c as G,d as k,f as H,e as V,k as B}from"./exam-gC5EqtFZ.js";const ee=T("exam",()=>{const g=I(!1),Q=I(!1),o=A(),d=$(),c=x({allList:[],list:[],total:0,pageArr:[{start:1,end:20,id:0}]}),t=x({curQuestionIndex:1,curIndex:0,childrenLength:0,curQuestionChildrenIndex:0,time_remain:0,sheet_id:"0",questions:[],answerData:[],type:0}),m=x({writing:{},spoken:{},hear:{},read:{}}),S=["read","spoken","hearing","writing"],f=I(""),p=x([]),h=M(),l=20,C=x({read:{remark:"Passage",height:184,promptText:"为适应新版托福形式变更，阅读模考需要从三篇中选择两篇.",maxSelectCount:2,minSelectCount:1},hearing:{remark:"Lecture",height:326,promptText:"为适应新版托福形式变更，听力模考section2需要选择1篇lecture",maxSelectCount:1,minSelectCount:1},spoken:{remark:"Task",height:249,promptText:"",maxSelectCount:4,minSelectCount:4},writing:{remark:["Integrated Writing","Academic discussion"],height:184,promptText:"",maxSelectCount:2,minSelectCount:2},mock:{height:249,remark:["Reading","Listening","Speaking","Writing"]}}),D=async(s,e)=>{const r=h.menuData.list,{pattern_id:n,name:a}=r.find(i=>i.key===o.name);if(e){f.value=a,c.pageArr=[];const i=await W({exam_id:1,pattern_id:n||"",limit:l,account_id:h.userInfo.account_id,page:s+1,whether_zt:!1});c.allList=o.name==="mock"?i.data[0].children:i.data,c.total=o.name==="mock"?c.allList.length:i.total,c.pageArr=new Array(Math.ceil(c.total/l)).fill(0).map((u,_)=>({start:_*l+1,end:Math.min((_+1)*l,c.total),id:_}))}c.list=c.allList.slice(s*l,(s+1)*l)},w=async(s,e,r)=>{const n=h.userInfo.account_id,a={q_type:s,question_ids:e,account_id:n};r&&(a.father_sheet=r);const i=await j(a);return t.sheet_id=i.sheet_id,i},L=async(s,e,r)=>{const n=h.userInfo.account_id;return await z({q_type:s,question_ids:e,account_id:n,father_sheet:r})},R=async(s,e)=>{try{t.curIndex=0,t.curQuestionIndex=0,t.curQuestionChildrenIndex=0,t.time_remain=0,t.sheet_id="",t.questions=[],t.answerData=[],t.type=0;const[r,n]=await Promise.all([G(s),k(s)]);t.answerData=n.map(a=>({is_answer:a.is_answer,question_id:a.question_id,answer:a.answer})),t.sheet_id=r.sheet_id,t.childrenLength=r.questions.reduce((a,i)=>a+i.children.length,0),e?(t.curQuestionIndex=Number(o.query.sectionIndex)||0,t.curQuestionChildrenIndex=Number(o.query.quesIndex)||0,t.curIndex=r.questions.slice(0,t.curQuestionIndex).reduce((a,i)=>{var u;return a+((u=i==null?void 0:i.children)==null?void 0:u.length)||0},0)+t.curQuestionChildrenIndex):(t.curQuestionIndex=0,t.curQuestionChildrenIndex=0,t.curIndex=0),t.time_remain=r.time_remain,t.questions=r.questions,t.type=r.type}catch{d.back()}},v=s=>{let e=t.curIndex+s;const r=t.childrenLength;e<=0&&(e=0),e===r&&(e=r-1);let n=0,a=0;t.questions.forEach((i,u)=>{const _=i.children,y=n+_.length;e>=n&&e<=y&&(a=u),n=y}),t.curIndex=e,t.curQuestionIndex=a,t.curQuestionChildrenIndex=a>0?e-t.questions.slice(0,a).reduce((i,u)=>i+u.children.length,0):e,d.replace({query:{...o.query,sectionIndex:t.curQuestionIndex,quesIndex:t.curQuestionChildrenIndex}})},P=q(()=>t.curIndex===t.childrenLength-1),E=q(()=>{var e;const s=t.questions[t.curQuestionIndex];if(s&&s.question_content&&s.children.length>0){let r=0;const n=(e=s.question_content)==null?void 0:e.replace(/\$\$/g,()=>`<span class="fill-item" data-index="${r++}">【 <b></b> 】</span>`);return{...s,cur_questions_content:n.split(/\\n/)}}return{children:[],question_content:"",question_title:"",cur_questions_content:""}}),b=q(()=>{var e;const s=(e=E.value)==null?void 0:e.children[t.curQuestionChildrenIndex];return s?{...s,isShowViewText:s.question_type==="Toefl_Reading_mc"}:null});return{types:S,getExamProcess:async s=>{try{const e=await k(s);p.length=0,p.push(...e)}catch(e){console.log(e)}},startMixedExam:L,getPastResult:async()=>{const s=h.userInfo.account_id,e=await B(s);m.hear=e.听力,m.writing=e.写作,m.spoken=e.口语,m.read=e.阅读},processData:p,pastScores:m,setShowProcessDialog:()=>{g.value=!g.value},showAnswerHistoryDialog:Q,showProcessDialog:g,getExamResource:D,exam_data:c,startExam:w,examing_data:t,changeQuestion:v,curQuestion:E,curQuestionChildren:b,getExamData:R,saveQuestion:async(s,e)=>{const r=t.answerData.findIndex(n=>n.question_id===s);t.answerData[r]={question_id:s,is_answer:!0,answer:e},await H({sheet_id:t.sheet_id,question_id:s,answer:e,duration:0})},isExamEnding:P,requestSubmitExam:async s=>{var a;await V(s);const{query:e,name:r}=o,n=N(`mixedExam-${e==null?void 0:e.mid}`);if((e==null?void 0:e.type)==="mixedExam"&&(e!=null&&e.mid)){r==="hearingExam"?(await w("mock_exam",n==null?void 0:n.quesid[2],n==null?void 0:n.father_sheet),d.push({name:"spokenExam",query:{type:"mixedExam",mid:n==null?void 0:n.father_sheet,name:n.resource_name,id:t.sheet_id}})):r==="spokenExam"?(await w("mock_exam",n==null?void 0:n.quesid[3],n==null?void 0:n.father_sheet),d.push({name:"writingExam",query:{type:"mixedExam",mid:n==null?void 0:n.father_sheet,name:n.resource_name,id:t.sheet_id}})):r==="writingExam"&&d.push(`/result/${n==null?void 0:n.father_sheet}?type=mock`);return}d.push(`/result/${s}?type=${(a=o==null?void 0:o.meta)==null?void 0:a.parent}`)},questionTitle:f,customData:C}});export{ee as u};
