import{_ as g}from"./children.vue_vue_type_script_setup_true_lang-FQL1-XRe.js";import{_ as h,K as E,q as b,r as _,$ as y,d as k,o as I,z as S,c as n,e as i,f as B,t as d,F as f,g as A,h as w,C}from"./index-VRJpYvlb.js";import{s as M}from"./ai-7XA0R86N.js";const O="/assets/aiassistant-3mBxNB_k.png";let x=0;const q=h("ai",()=>{const t=E([]),a=b(),l=_(!1),e={toeflType:"",queryType:"",chatbotQuery:"","Main Content":"",mcq:"",problemMethod:""};return{init:async()=>{l.value||(t.push({type:"receive",name:y.global.t("鹦鹉AI助教"),isEnd:!1,id:"init",content:[y.global.t("nice to meet you")]}),l.value=!0)},list:t,sendMessage:async r=>{t.push({type:"send",id:x++,name:a.userInfo.name,content:r});const{clientId:s}=await M({...e,chatbotQuery:r,toeflType:"Writing",queryType:"其他问题"}),o=[],m=new EventSource(`/ai-api/v1/modelapi/assistantChatbot/${s}/`);m.onmessage=function(u){o.push(u.data.replace(/\[DONE!\]/,"")),u.data.match(/\[DONE!\]/)&&(t.push({type:"receive",id:x++,isEnd:!1,name:"鹦鹉AI助教",content:o}),m.close())}},setIsEnd:r=>{const s=t.find(o=>o.id===r);s&&s.isEnd&&(s.isEnd=!0)}}}),N={class:"text-[#344054] font-normal text-[14px] pb-1"},T={key:0,class:"py-[10px] px-[14px] items-center text-base mt-2 inline-block"},$={key:1,class:"py-[10px] px-[14px] items-center text-base mt-2 inline-block"},D={key:1,class:"py-[10px] px-[14px] items-center text-base mt-2 inline-block"},j=k({__name:"item",props:{content:{},type:{},name:{},isEnd:{type:Boolean},id:{},onAllEnd:{type:Function}},setup(t){const a=_(1),l=q(),e=t;I(()=>{a.value=1});const c=S(()=>e.type==="receive"&&!e.isEnd?e.content.slice(0,a.value):e.content),p=()=>{a.value++,a.value>e.content.length&&(l.setIsEnd(e.id),e==null||e.onAllEnd())};return(v,r)=>(n(),i("div",{class:C(["mb-3 overflow-hidden",{"left-msg":e.type==="receive","right-msg":e.type==="send"}])},[B("h2",N,d(e.name),1),e.isEnd?(n(),i("p",D,d(e.type==="send"?c.value:c.value.join("").replaceAll(`
`,"")),1)):(n(),i(f,{key:0},[e.type==="send"?(n(),i("p",T,d(c.value),1)):(n(),i("p",$,[(n(!0),i(f,null,A(c.value,(s,o)=>(n(),w(g,{word:s,onended:p,key:o},null,8,["word"]))),128))]))],64))],2))}});export{j as _,O as a,q as u};
