import{ak as y,X as W,r as B,N as H,C as A,v as J,am as P}from"./index-QdoVddfu.js";const v=i=>y.post("/api/system/microservice/resource/",i),ee=i=>y.post("/api/system/microservice/create_mock/",i),te=i=>y.get(`/api/system/microservice/get_mock/${i}/`),oe=i=>y.get(`/api/system/microservice/answer_status/${i}/`),se=i=>y.post("/api/system/microservice/answer_panel/",i),re=i=>y.post(`/api/system/microservice/submit_answers/${i}/`),F=i=>y.post(`/api/system/microservice/scoring/${i}/`),U=i=>y.get(`/api/system/microservice/get_score/${i}/`),K=i=>y.get(`/api/system/microservice/get_score_repeat/${i}/`),ne=i=>y.get(`/api/system/microservice/get_past_scores/${i}/`),ae=(i,f)=>y.post("/api/system/microservice/grade_answer/",{sheet_id:i,question_id:f}),ce=i=>y.post("/api/system/microservice/create_mock_sheet/",i),T={27:"A+",25:"A",23:"A-",21:"B+",19:"B",17:"B-",15:"C+",13:"C",10:"C-",0:"F"},O={10:"A+",9:"A",8:"A-","7.5":"B+",7:"B",6:"B-","5.5":"C+",5:"C",4:"C-",0:"F"},V={"Integrated Writing":[{key:"Content & Details Given",title:"内容与细节"},{key:"Grammar",title:"语法"},{key:"Structure/Flow",title:"结构与流畅度"}],"Academic discussion":[{key:"Contribution",title:"内容贡献"},{key:"Relevance",title:"相关性"},{key:"Structure/Flow",title:"结构与流畅度"},{key:"Grammar",title:"语法"}]},X=[{key:["Fluency","Pronunciation"],title:"流利度"},{key:["Grammar","Vocabulary Usage"],title:"语法与词汇"},{key:"Content",title:"内容"},{key:"Coherence",title:"连贯性"}],R=[{type:"内容",id:"Content",style:{color:"#667085",background:"rgba(253, 212, 78, 0.3)"}},{type:"连贯性",id:"Coherence",style:{color:"#667085","text-decoration-line":"underline","text-decoration-color":"#667085"}},{type:"语法",id:"Grammar and Language Use",style:{color:"#667085","text-decoration-line":"underline","text-decoration-style":"dashed","text-decoration-color":"#C33473"}},{type:"优秀用句",id:"Good",style:{color:"#667085",background:"rgba(183, 217, 114, 0.3)"}}],z=[{type:"内容与细节",id:"Content & Details Given",style:{color:"#667085",background:"rgba(253, 212, 78, 0.3)"}},{type:"结构与流畅度",id:"Structure/Flow",style:{color:"#667085","text-decoration-line":"underline","text-decoration-color":"#667085"}},{type:"语法",id:"Grammar",style:{color:"#667085","text-decoration-line":"underline","text-decoration-style":"dashed","text-decoration-color":"#C33473"}},{type:"优秀用句",id:"Good",style:{color:"#667085",background:"rgba(183, 217, 114, 0.3)"}}],Q=[{type:"贡献度与相关性",id:["Contribution","Relevance"],style:{color:"#667085",background:"rgba(253, 212, 78, 0.3)"}},{type:"结构与流畅度",id:"Structure/Flow",style:{color:"#667085","text-decoration-line":"underline","text-decoration-color":"#667085"}},{type:"语法",id:"Grammar",style:{color:"#667085","text-decoration-line":"underline","text-decoration-style":"dashed","text-decoration-color":"#C33473"}},{type:"优秀用句",id:"Good",style:{color:"#667085",background:"rgba(183, 217, 114, 0.3)"}}],ie=W("result",()=>{const i=B(!1),{query:f}=H(),a=A({loading:!0,title:"",level:"",footerActiveIndex:0,allData:[],aiComment:"",questions_r:{},format_question:[],score_d:[]}),S=A([]),$=t=>t.replace(/TPO\s?\d+/g,""),I=()=>{i.value=!i.value},D=async t=>{await P(5e3),await F(t);const r=await K(t);r.score===null?D(t):G(r)},w=t=>{const r=t==null?void 0:t.model_answer;if(!r)return{model_answer_content:{},model_answer:""};const n=typeof r=="string"?JSON.parse(r):r;if(n["General Feedback"]){const o=n["General Feedback"].split(/\n?(.+):\s/i).slice(1);n.format_G_F=new Array(o.length/2).fill(0).reduce((s,c,e)=>(s[o[e*2]]=o[e*2+1],s),{})}return n["Mind-Map"]&&(n.format_M_M=n["Mind-Map"].split(/\n/)),{model_answer_content:n,model_answer:r}},h=(t,r)=>{const n=JSON.parse(JSON.stringify(t));return n.forEach(o=>{const s=r==null?void 0:r.filter(c=>o.include.includes(c.name));o.total=0,o.count=0,s==null||s.forEach(c=>{console.log(c),o.total+=c.count,o.count+=c.sum}),o.isComputed=!0}),{list:n,tags:r==null?void 0:r.map(o=>({...o,name:o.name.replace(/^(阅读|听力)/g,"")}))}},M=t=>{const r=Object.values(t.score_d);if(f.type==="hearing"){const n=[{title:"基础题",include:["听力目的主旨题","听力内容主旨题","听力细节题"]},{title:"强化题",include:["听力推理题","听力句子功能题","听力连结内容题","听力组织结构题"]}],o=r.map(s=>{const c=s.find(e=>e.name.endsWith("Conversation2")||e.name.endsWith("Lecture3")||e.name.endsWith("Lecture4"))?2:1;return{title:"Section "+c,id:c}});return console.log(o),a.allData[0]={layout:"col",name:"听力得分",mockScore:t.score,mockScoreTotal:t.max_score,aiComment:"",list:r.map((s,c)=>({...o[c],children:s.map((e,u)=>({title:e.name.split(/\s/).slice(-1)[0],id:`${c}-${u}`,count:e.count,total:e.total,isComputed:s.score!==null}))}))},a.allData.push(...o.map((s,c)=>{var e,u;return{subtitle:s.title,layout:"row",name:"Raw Score",mockScore:(e=r[c])==null?void 0:e.reduce((d,m)=>d+m.count,0),mockScoreTotal:(u=r[c])==null?void 0:u.reduce((d,m)=>d+m.total,0),...h(n,t.tag_d[c+1]),aiComment:""}})),o}else if(f.type==="spoken"){const n=r[0].map((o,s)=>({title:"Task "+o.name.split(/\s/).slice(-1)[0],id:`${s}`}));return a.allData[0]={layout:"col",name:"口语得分",mockScore:t.questions_r.questions.reduce((o,s)=>o+s.score,0),mockScoreTotal:t.max_score,list:t.questions_r.questions.map((o,s)=>({title:"Task "+o.order,id:s,isComputed:o.score!==null,count:o.score,total:o.max_score}))},a.allData.push(...n.map((o,s)=>{var m;const{model_answer:c,model_answer_content:e}=w(t.questions_r.questions[s]),u=e==null?void 0:e.Content.filter(l=>Object.keys(l).length>0),d=R;return{layout:"col",name:o.title,mockScore:t.questions_r.questions[s].score,mockScoreTotal:t.questions_r.questions[s].max_score,aiComment:(m=e==null?void 0:e.format_G_F)==null?void 0:m.General,model_answer:c,model_answer_content:{...e,sent_back:u.map(l=>Object.keys(l).reduce((k,p)=>{var q;const g=(q=e["Sentence Feedback"][p].Type)==null?void 0:q.reduce((C,_)=>{var x;return{...(x=d.find(b=>b.id===_||b.id.includes(_)))==null?void 0:x.style}},{});return k[p]={...e["Sentence Feedback"][p],original:l[p],style:g,curStyle:{...g},aiStyle:{...g}},k},{}))},question:t.questions_r.questions[s],curIndex:s+1,length:t.questions_r.questions.length,ques_mark:R,list:X.map(l=>{var p,g;const k=Array.isArray(l.key)?l.key.reduce((q,C)=>{var _;return Number((_=e==null?void 0:e.Grades)==null?void 0:_[C])+q},0):(p=e==null?void 0:e.Grades)==null?void 0:p[l.key];return{title:l.title,count:e?(k/2).toFixed(1):(g=e==null?void 0:e.Grades)==null?void 0:g[o.key],isComputed:(e==null?void 0:e.Status)==="OK",total:4}})}})),n}else if(f.type==="writing"){const n=r.map((o,s)=>({title:Number(o[0].name.slice(-1))===1?"Integrated Writing":"Academic discussion",id:`${s}`}));return a.allData[0]={layout:"col",name:"写作得分",mockScore:t.questions_r.questions.reduce((o,s)=>o+s.score,0),mockScoreTotal:t.max_score,list:t.questions_r.questions.map((o,s)=>({title:o.keywords.r===1200?"Integrated Writing":"Academic discussion",id:s,isComputed:o.score!==null,count:o.score,total:o.max_score})),aiComment:""},a.allData.push(...n.map((o,s)=>{var m;const{model_answer:c,model_answer_content:e}=w(t.questions_r.questions[s]),u=e==null?void 0:e.Content.filter(l=>Object.keys(l).length>0),d=o.title==="Integrated Writing"?z:Q;return console.log(e),{layout:"col",name:o.title,ques_mark:d,mockScore:t.questions_r.questions[s].score,mockScoreTotal:t.questions_r.questions[s].max_score,aiComment:(m=e==null?void 0:e.format_G_F)==null?void 0:m.General,model_answer:c,model_answer_content:{...e,sent_back:u.map(l=>Object.keys(l).reduce((k,p)=>{var q;const g=(q=e["Sentence Feedback"][p].Type)==null?void 0:q.reduce((C,_)=>{var x;return{...(x=d.find(b=>b.id===_||b.id.includes(_)))==null?void 0:x.style}},{});return k[p]={...e["Sentence Feedback"][p],original:l[p],style:g,curStyle:{...g},aiStyle:{...g}},k},{}))},question:t.questions_r.questions[s],curIndex:s+1,length:t.questions_r.questions.length,list:V[o.title].map(l=>({title:l.title,count:(e==null?void 0:e.Grades[l.key])||0,isComputed:(e==null?void 0:e.Grades[l.key])!==null,total:5}))}})),n}else{const n=[{title:"基础题",include:["阅读词汇题","阅读指代题","阅读简化句子题","阅读细节题","阅读排除题"]},{title:"强化题",include:["阅读修辞目的题","阅读插入句子题","阅读推断题"]},{title:"文章小结题",include:["阅读文章内容小结题","阅读表格题"]}],o=r.map((s,c)=>({title:$(s[0].name),id:`${c}`}));return a.allData[0]={layout:"row",name:"模考得分",mockScore:t.score,mockScoreTotal:t.max_score,aiComment:"",...h(n,t.tag_d.all)},a.allData.push(...o.map((s,c)=>{var e,u;return{layout:"row",name:"Raw Score",subtitle:s.title,mockScore:(e=r[c])==null?void 0:e.reduce((d,m)=>d+m.count,0),mockScoreTotal:(u=r[c])==null?void 0:u.reduce((d,m)=>d+m.total,0),aiComment:"",...h(n,t.tag_d[c+1])}})),o}},j=(t,r)=>{const n=Object.keys(t===1?T:O).find(o=>r>=Number(o));return t===1?T[n]:O[n]},G=t=>{a.questions_r=t.questions_r,a.score_d=Object.values(t.score_d),a.format_question=t.questions_r.questions.reduce((r,n)=>(r.push(...Array.isArray(n.children)&&n.children.length?n.children.map(o=>{var c;const s=(c=n.question_content)==null?void 0:c.split(/\\n/);return{...o,question_parent:{...n,original_question_content:s,question_content:s==null?void 0:s.map(e=>e.replaceAll(n.keywords.k,"")),question_title:n.question_title?n.question_title:"听力原文",children:null}}}):[]),r),[]),S.length=0,S.push({title:"报告",id:"all"},...M(t)),a.title=`${a.score_d[0][0].name.match(/^(TPO\s?\d+)/)[1]} 成绩单`,a.level=j(t.type,t.score),a.loading=!1},E=t=>{const r=[{title:"阅读",id:"reading",layout:"row"},{title:"听力",id:"hearing",layout:"col"},{title:"口语",id:"spoken",layout:"col"},{title:"写作",id:"writing",layout:"table"}];console.log(t),a.questions_r=[],a.score_d=[],a.format_question=[],S.length=0,S[0]={title:"模考",id:"all"},S.push(...r),a.allData[0]={layout:"col",name:"总分",mockScore:t.score,mockScoreTotal:120,aiComment:"",list:r.map((n,o)=>({title:n.title,isComputed:!0,total:t.detail[o].max_score,count:t.detail[o].score}))},a.allData.push(...r.map((n,o)=>({}))),a.loading=!1},N=async t=>{a.title="",a.level="",a.footerActiveIndex=0,a.allData=[],a.aiComment="",a.questions_r={},a.format_question=[],a.score_d=[],a.loading=!0,await F(t);const r=await U(t);if(r.score!==null){if(f.type==="mock"){E(r);return}G(r)}else D(t)},L=J(()=>a.allData[a.footerActiveIndex]);return{getExamResult:N,showHoverMark:(t,r,n,o)=>{var c;((c=a.allData.slice(1)[n])==null?void 0:c.model_answer_content.sent_back).map(e=>{Object.keys(e).map(u=>{o==="hover"?t===u?e[u].curStyle={...e[t].style,"font-weight":"700"}:e[u].curStyle={}:e[u].curStyle=e[u].style})})},curData:L,resultData:a,setShowAnswerHistoryDialog:I,showAnswerHistoryDialog:i,footerData:S}});export{oe as a,re as b,F as c,U as d,se as e,ae as f,v as g,ee as h,ce as i,ne as j,te as r,ie as u};
