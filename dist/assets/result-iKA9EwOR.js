import{ak as D,Z as z,r as Q,S as V,J as K,z as Z,am as X,x as Y}from"./index-39-nGnoZ.js";const it=l=>D.post("/api/system/microservice/resource/",l),ct=l=>D.post("/api/system/microservice/create_mock/",l),lt=l=>D.get(`/api/system/microservice/get_mock/${l}/`),ut=l=>D.get(`/api/system/microservice/answer_status/${l}/`),mt=l=>D.post("/api/system/microservice/answer_panel/",l),dt=l=>D.post(`/api/system/microservice/submit_answers/${l}/`),v=l=>D.post(`/api/system/microservice/scoring/${l}/`),tt=l=>D.get(`/api/system/microservice/get_score/${l}/`),W=l=>D.get(`/api/system/microservice/get_score_repeat/${l}/`),yt=l=>D.get(`/api/system/microservice/get_past_scores/${l}/`),pt=(l,G)=>D.post("/api/system/microservice/grade_answer/",{sheet_id:l,question_id:G}),gt=l=>D.post("/api/system/microservice/create_mock_sheet/",l),j={10:"A+",9:"A",8:"A-","7.5":"B+",7:"B",6:"B-","5.5":"C+",5:"C",4:"C-",0:"F"},et={"Integrated Writing":[{key:"Content & Details Given",title:"内容与细节"},{key:"Grammar",title:"语法"},{key:"Structure/Flow",title:"结构与流畅度"}],"Academic discussion":[{key:"Contribution",title:"内容贡献"},{key:"Relevance",title:"相关性"},{key:"Structure/Flow",title:"结构与流畅度"},{key:"Grammar",title:"语法"}]},ot=[{key:["Fluency","Pronunciation"],title:"流利度"},{key:["Grammar","Vocabulary Usage"],title:"语法与词汇"},{key:"Content",title:"内容"},{key:"Coherence",title:"连贯性"}],L=[{type:"内容",id:"Content",style:{color:"#667085",background:"rgba(253, 212, 78, 0.3)"}},{type:"连贯性",id:"Coherence",style:{color:"#667085","text-decoration-line":"underline","text-decoration-color":"#667085"}},{type:"语法",id:"Grammar and Language Use",style:{color:"#667085","text-decoration-line":"underline","text-decoration-style":"dashed","text-decoration-color":"#C33473"}},{type:"优秀用句",id:"Good",style:{color:"#667085",background:"rgba(183, 217, 114, 0.3)"}}],st=[{type:"内容与细节",id:"Content & Details Given",style:{color:"#667085",background:"rgba(253, 212, 78, 0.3)"}},{type:"结构与流畅度",id:"Structure/Flow",style:{color:"#667085","text-decoration-line":"underline","text-decoration-color":"#667085"}},{type:"语法",id:"Grammar",style:{color:"#667085","text-decoration-line":"underline","text-decoration-style":"dashed","text-decoration-color":"#C33473"}},{type:"优秀用句",id:"Good",style:{color:"#667085",background:"rgba(183, 217, 114, 0.3)"}}],at=[{type:"贡献度与相关性",id:["Contribution","Relevance"],style:{color:"#667085",background:"rgba(253, 212, 78, 0.3)"}},{type:"结构与流畅度",id:"Structure/Flow",style:{color:"#667085","text-decoration-line":"underline","text-decoration-color":"#667085"}},{type:"语法",id:"Grammar",style:{color:"#667085","text-decoration-line":"underline","text-decoration-style":"dashed","text-decoration-color":"#C33473"}},{type:"优秀用句",id:"Good",style:{color:"#667085",background:"rgba(183, 217, 114, 0.3)"}}],qt=z("result",()=>{const l=Q(!1),G=V(),s=K({loading:!0,title:"",level:"",footerActiveIndex:0,allData:[],type:"",aiComment:"",navData:[],questions_r:{},format_question:[],score_d:[],AnnotationData:[]}),C=K([]),H=e=>e.replace(/TPO\s?\d+/g,""),J=()=>{const{query:e}=G;if(e.type==="mock"){const r=C[s.footerActiveIndex],o=s.allData[s.footerActiveIndex];s.type=r.id,s.format_question=w(o.originData),s.questions_r=o.originData.questions_r,(s.type==="spoken"||s.type==="writing")&&(s.AnnotationData=o.formatAllData.allData.slice(1)),s.type==="hearing"&&(s.navData=o.list)}l.value=!l.value},I=async e=>{await X(5e3),await v(e);const r=await W(e);r.score===null?I(e):M(r)},$=e=>{const r=e==null?void 0:e.model_answer;if(!r)return{model_answer_content:{},model_answer:""};const o=typeof r=="string"?JSON.parse(r):r;if(o["General Feedback"]){const u=o["General Feedback"].split(/\n?(.+):\s/i).slice(1);o.format_G_F=new Array(u.length/2).fill(0).reduce((m,a,n)=>(m[u[n*2]]=u[n*2+1],m),{})}return o["Mind-Map"]&&(o.format_M_M=o["Mind-Map"].split(/\n/)),{model_answer_content:o,model_answer:r}},T=(e,r)=>{const o=JSON.parse(JSON.stringify(e));return o.forEach(u=>{const m=r==null?void 0:r.filter(a=>u.include.includes(a.name));u.total=0,u.count=0,m==null||m.forEach(a=>{u.total+=a.count,u.count+=a.sum}),u.isComputed=!0}),{list:o,tags:r==null?void 0:r.map(u=>({...u,name:u.name.replace(/^(阅读|听力)/g,"")}))}},R=(e,r)=>{var u,m;const o=Object.values(e.score_d);if(r==="hearing"){const a=[{title:"基础题",include:["听力目的主旨题","听力内容主旨题","听力细节题"]},{title:"强化题",include:["听力推理题","听力句子功能题","听力连结内容题","听力组织结构题"]}],n=o.map(i=>{const d=i.find(t=>t.name.endsWith("Conversation2")||t.name.endsWith("Lecture3")||t.name.endsWith("Lecture4"))?2:1;return{title:"Section "+d,id:d}});let g=0;const c={layout:"col",name:"听力得分",mockScore:e.score,mockScoreTotal:e.max_score,level:h(e.score,e.max_score),aiComment:"",list:o.map((i,d)=>{const t=i.reduce((y,p)=>(p.name.includes("Conversation")?y.unshift(p):y.push(p),y),[]);return{...n[d],children:t.map((y,p)=>{var q,x;return{title:y.name.split(/\s/).slice(-1)[0],id:`${d}-${p}`,count:y.count,total:y.total,isComputed:i.score!==null,index:p+d*3,navNum:(x=(q=e.questions_r)==null?void 0:q.questions)==null?void 0:x[p+d*3].children.map(()=>g++)}})}})};return s.navData=c.list,{allData:[c,...n.map((i,d)=>{var p,q;const t=(p=o[d])==null?void 0:p.reduce((x,k)=>x+k.count,0),y=(q=o[d])==null?void 0:q.reduce((x,k)=>x+k.total,0);return{subtitle:i.title,layout:"row",level:h(t,y),name:"Raw Score",mockScore:t,mockScoreTotal:y,...T(a,e.tag_d[d+1]),aiComment:""}})],footerData:n}}else if(r==="spoken"){const a=o[0].map((c,i)=>({title:"Task "+c.name.split(/\s/).slice(-1)[0],id:`${i}`})),n=a.map((c,i)=>{var q,x;const{model_answer:d,model_answer_content:t}=$(e.questions_r.questions[i]),y=(q=t==null?void 0:t.Content)==null?void 0:q.filter(k=>Object.keys(k).length>0),p=L;return{layout:"col",name:c.title,level:h(e.questions_r.questions[i].score,e.questions_r.questions[i].max_score),mockScore:(t==null?void 0:t.Status)==="OK"?e.questions_r.questions[i].score:"Na",mockScoreTotal:e.questions_r.questions[i].max_score,aiComment:(t==null?void 0:t.Status)==="OK"?(x=t==null?void 0:t.format_G_F)==null?void 0:x.General:(t==null?void 0:t.msg)==="用量已超使用上限制"?"🔒您的今日免费批改次数已用尽，如需批改，请前往价格页购买。":t==null?void 0:t.msg,model_answer:d,model_answer_content:{...t,sent_back:y==null?void 0:y.map(k=>Object.keys(k).reduce((_,S)=>{var b;const f=(b=t["Sentence Feedback"][S].Type)==null?void 0:b.reduce((O,F)=>{var A;return{...(A=p.find(N=>N.id===F||N.id.includes(F)))==null?void 0:A.style}},{});return _[S]={...t["Sentence Feedback"][S],original:k[S],style:f,curStyle:{...f},aiStyle:{...f}},_},{}))},question:e.questions_r.questions[i],curIndex:i+1,length:e.questions_r.questions.length,ques_mark:L,list:ot.map(k=>{var S,f,b;const _=Array.isArray(k.key)?k.key.reduce((O,F)=>{var A;return Number((A=t==null?void 0:t.Grades)==null?void 0:A[F])+O},0):(S=t==null?void 0:t.Grades)==null?void 0:S[k.key];return{title:k.title,count:(t==null?void 0:t.Status)==="OK"?t?_/2:(f=t==null?void 0:t.Grades)==null?void 0:f[c.key]:"Na",isComputed:((b=t==null?void 0:t.Grades)==null?void 0:b[k.key])!==null,total:4}})}});s.AnnotationData=n;const g=n[0];return{allData:[{layout:"col",name:"口语得分",level:h(e.score,a.length===4?30:e==null?void 0:e.max_score),mockScore:((u=g.model_answer_content)==null?void 0:u.Status)==="OK"?e==null?void 0:e.score:"Na",mockScoreTotal:a.length===4?30:e==null?void 0:e.max_score,list:e.questions_r.questions.map((c,i)=>{var d;return{title:"Task "+c.order,id:i,isComputed:c.score!==null,count:((d=g.model_answer_content)==null?void 0:d.Status)==="OK"?c.score:"Na",total:c.max_score}})},...n],footerData:a}}else if(r==="writing"){const a=o.map((c,i)=>({title:Number(c[0].name.slice(-1))===1?"Integrated Writing":"Academic discussion",id:`${i}`})),n=a.map((c,i)=>{var q,x,k;const{model_answer:d,model_answer_content:t}=$(e.questions_r.questions[i]),y=(x=(q=t==null?void 0:t.Content)==null?void 0:q.filter)==null?void 0:x.call(q,_=>Object.keys(_).length>0),p=c.title==="Integrated Writing"?st:at;return{layout:"col",name:c.title,ques_mark:p,mockScore:(t==null?void 0:t.Status)==="OK"?e.questions_r.questions[i].score:"Na",mockScoreTotal:e.questions_r.questions[i].max_score,level:h(e.questions_r.questions[i].score,e.questions_r.questions[i].max_score),aiComment:(t==null?void 0:t.Status)==="OK"?(k=t==null?void 0:t.format_G_F)==null?void 0:k.General:(t==null?void 0:t.msg)==="用量已超使用上限制"?"🔒您的今日免费批改次数已用尽，如需批改，请前往价格页购买。":t==null?void 0:t.msg,model_answer:d,model_answer_content:{...t,sent_back:y==null?void 0:y.map(_=>Object.keys(_).reduce((S,f)=>{var O;const b=(O=t["Sentence Feedback"][f].Type)==null?void 0:O.reduce((F,A)=>{var N;return{...(N=p.find(E=>E.id===A||E.id.includes(A)))==null?void 0:N.style}},{});return S[f]={...t["Sentence Feedback"][f],original:_[f],style:b,curStyle:{...b},aiStyle:{...b}},S},{}))},question:e.questions_r.questions[i],curIndex:i+1,length:e.questions_r.questions.length,list:et[c.title].map(_=>{var S,f;return{title:_.title,count:(t==null?void 0:t.Status)==="OK"?(S=t==null?void 0:t.Grades)==null?void 0:S[_.key]:"Na",isComputed:((f=t==null?void 0:t.Grades)==null?void 0:f[_.key])!==null,total:5}})}}),g=n[0];return s.AnnotationData=n,{footerData:a,allData:[{layout:"col",name:"写作得分",mockScore:((m=g.model_answer_content)==null?void 0:m.Status)==="OK"?e.score:"Na",mockScoreTotal:a.length*15,level:h(e.score,a.length*15),list:e.questions_r.questions.map((c,i)=>{var d;return{title:c.keywords.r===1200?"Integrated Writing":"Academic discussion",id:i,isComputed:c.score!==null,count:((d=g.model_answer_content)==null?void 0:d.Status)==="OK"?c.score:"Na",total:c.max_score}}),aiComment:""},...n]}}else{const a=[{title:"基础题",include:["阅读词汇题","阅读指代题","阅读简化句子题","阅读细节题","阅读排除题"]},{title:"强化题",include:["阅读修辞目的题","阅读插入句子题","阅读推断题"]},{title:"文章小结题",include:["阅读文章内容小结题","阅读表格题"]}],n=o.map((g,c)=>({title:H(g[0].name),id:`${c}`}));return{footerData:n,allData:[{layout:"row",name:"阅读得分",mockScore:e.score,mockScoreTotal:e.max_score,level:h(e.score,e.max_score),aiComment:"",...T(a,e.tag_d.all)},...n.map((g,c)=>{var t,y;const i=(t=o[c])==null?void 0:t.reduce((p,q)=>p+q.count,0),d=(y=o[c])==null?void 0:y.reduce((p,q)=>p+q.total,0);return{layout:"row",name:"Raw Score",subtitle:g.title,mockScore:i,mockScoreTotal:d,level:h(i,d),aiComment:"",...T(a,e.tag_d[c+1])}})]}}},h=(e,r)=>{const o=e*(10/r),u=Object.keys(j).sort((a,n)=>a-n),m=u.find((a,n)=>o>=Number(a)&&o<Number(n===u.length-1?11:u[n+1]),0);return j[m]},w=e=>e.questions_r.questions.reduce((r,o)=>(r.push(...Array.isArray(o.children)&&o.children.length?o.children.map(u=>{var a;const m=(a=o.question_content)==null?void 0:a.split(/\\n/);return{...u,question_parent:{...o,original_question_content:m,question_content:m==null?void 0:m.map(n=>n.replaceAll(o.keywords.k,"")),question_title:o.question_title?o.question_title:"听力原文",children:null}}}):[]),r),[]),M=e=>{s.questions_r=e.questions_r,s.score_d=Object.values(e.score_d);const{query:r}=G;s.type=r.type,s.format_question=w(e),C.length=0;const o=R(e,r.type);C.push({title:"报告",id:"all"},...o.footerData),s.allData=o.allData,s.title=`${s.score_d[0][0].name.match(/^(TPO\s?\d+)/)[1]} 成绩单`,s.loading=!1},B=async e=>{var u;const{params:r}=G,o=[{title:"阅读",id:"read",layout:"row"},{title:"听力",id:"hearing",layout:"col"},{title:"口语",id:"spoken",layout:"col"},{title:"写作",id:"writing",layout:"table"}];s.questions_r=[],s.score_d=[],s.format_question=[],C.length=0,C[0]={title:"模考",id:"MixedAll"},C.push(...o),s.allData[0]={layout:"col",name:"总分",mockScore:e.score,mockScoreTotal:120,level:h(e.score,120),aiComment:"",list:o.map((m,a)=>({title:m.title,isComputed:!0,total:e.detail[a].max_score,count:e.detail[a].score}))};for(let m=0;m<o.length;m++){const a=await W(e.detail[m].sheet_id),n=R(a,o[m].id);s.allData.push({...n.allData[0],formatAllData:n,originData:a})}s.title=((u=Y("mixedExam-"+r.sheetId))==null?void 0:u.resource_name)||"模考成绩单",s.loading=!1},P=async e=>{const{query:r}=G;s.title="",s.level="",s.footerActiveIndex=0,s.allData=[],s.aiComment="",s.questions_r={},s.format_question=[],s.score_d=[],s.loading=!0,C.length=0,await v(e);const o=await tt(e);if(o.score!==null){if(r.type==="mock"){B(o);return}M(o)}else I(e)},U=Z(()=>s.allData[s.footerActiveIndex]);return{getExamResult:P,showHoverMark:(e,r,o,u)=>{var a;((a=s.allData.slice(1)[o])==null?void 0:a.model_answer_content.sent_back).map(n=>{Object.keys(n).map(g=>{u==="hover"?e===g?n[g].curStyle={...n[e].style,"font-weight":"700"}:n[g].curStyle={}:n[g].curStyle=n[g].style})})},curData:U,resultData:s,setShowAnswerHistoryDialog:J,showAnswerHistoryDialog:l,footerData:C}});export{ut as a,dt as b,v as c,tt as d,mt as e,pt as f,it as g,ct as h,gt as i,yt as j,lt as r,qt as u};
