import{ak as y,X as B,r as H,N as J,C as F,v as P,am as U}from"./index-ZyeamsUE.js";const ee=l=>y.post("/api/system/microservice/resource/",l),te=l=>y.post("/api/system/microservice/create_mock/",l),oe=l=>y.get(`/api/system/microservice/get_mock/${l}/`),se=l=>y.get(`/api/system/microservice/answer_status/${l}/`),re=l=>y.post("/api/system/microservice/answer_panel/",l),ne=l=>y.post(`/api/system/microservice/submit_answers/${l}/`),T=l=>y.post(`/api/system/microservice/scoring/${l}/`),K=l=>y.get(`/api/system/microservice/get_score/${l}/`),V=l=>y.get(`/api/system/microservice/get_score_repeat/${l}/`),ae=l=>y.get(`/api/system/microservice/get_past_scores/${l}/`),ce=(l,b)=>y.post("/api/system/microservice/grade_answer/",{sheet_id:l,question_id:b}),ie=l=>y.post("/api/system/microservice/create_mock_sheet/",l),O={27:"A+",25:"A",23:"A-",21:"B+",19:"B",17:"B-",15:"C+",13:"C",10:"C-",0:"F"},R={10:"A+",9:"A",8:"A-","7.5":"B+",7:"B",6:"B-","5.5":"C+",5:"C",4:"C-",0:"F"},X={"Integrated Writing":[{key:"Content & Details Given",title:"内容与细节"},{key:"Grammar",title:"语法"},{key:"Structure/Flow",title:"结构与流畅度"}],"Academic discussion":[{key:"Contribution",title:"内容贡献"},{key:"Relevance",title:"相关性"},{key:"Structure/Flow",title:"结构与流畅度"},{key:"Grammar",title:"语法"}]},z=[{key:["Fluency","Pronunciation"],title:"流利度"},{key:["Grammar","Vocabulary Usage"],title:"语法与词汇"},{key:"Content",title:"内容"},{key:"Coherence",title:"连贯性"}],$=[{type:"内容",id:"Content",style:{color:"#667085",background:"rgba(253, 212, 78, 0.3)"}},{type:"连贯性",id:"Coherence",style:{color:"#667085","text-decoration-line":"underline","text-decoration-color":"#667085"}},{type:"语法",id:"Grammar and Language Use",style:{color:"#667085","text-decoration-line":"underline","text-decoration-style":"dashed","text-decoration-color":"#C33473"}},{type:"优秀用句",id:"Good",style:{color:"#667085",background:"rgba(183, 217, 114, 0.3)"}}],Q=[{type:"内容与细节",id:"Content & Details Given",style:{color:"#667085",background:"rgba(253, 212, 78, 0.3)"}},{type:"结构与流畅度",id:"Structure/Flow",style:{color:"#667085","text-decoration-line":"underline","text-decoration-color":"#667085"}},{type:"语法",id:"Grammar",style:{color:"#667085","text-decoration-line":"underline","text-decoration-style":"dashed","text-decoration-color":"#C33473"}},{type:"优秀用句",id:"Good",style:{color:"#667085",background:"rgba(183, 217, 114, 0.3)"}}],Y=[{type:"贡献度与相关性",id:["Contribution","Relevance"],style:{color:"#667085",background:"rgba(253, 212, 78, 0.3)"}},{type:"结构与流畅度",id:"Structure/Flow",style:{color:"#667085","text-decoration-line":"underline","text-decoration-color":"#667085"}},{type:"语法",id:"Grammar",style:{color:"#667085","text-decoration-line":"underline","text-decoration-style":"dashed","text-decoration-color":"#C33473"}},{type:"优秀用句",id:"Good",style:{color:"#667085",background:"rgba(183, 217, 114, 0.3)"}}],le=B("result",()=>{const l=H(!1),b=J(),n=F({loading:!0,title:"",level:"",footerActiveIndex:0,allData:[],aiComment:"",questions_r:{},format_question:[],score_d:[]}),q=F([]),I=t=>t.replace(/TPO\s?\d+/g,""),M=()=>{l.value=!l.value},w=async t=>{await U(5e3),await T(t);const c=await V(t);c.score===null?w(t):A(c)},G=t=>{const c=t==null?void 0:t.model_answer;if(!c)return{model_answer_content:{},model_answer:""};const r=typeof c=="string"?JSON.parse(c):c;if(r["General Feedback"]){const a=r["General Feedback"].split(/\n?(.+):\s/i).slice(1);r.format_G_F=new Array(a.length/2).fill(0).reduce((s,o,i)=>(s[a[i*2]]=a[i*2+1],s),{})}return r["Mind-Map"]&&(r.format_M_M=r["Mind-Map"].split(/\n/)),{model_answer_content:r,model_answer:c}},C=(t,c)=>{const r=JSON.parse(JSON.stringify(t));return r.forEach(a=>{const s=c==null?void 0:c.filter(o=>a.include.includes(o.name));a.total=0,a.count=0,s==null||s.forEach(o=>{console.log(o),a.total+=o.count,a.count+=o.sum}),a.isComputed=!0}),{list:r,tags:c==null?void 0:c.map(a=>({...a,name:a.name.replace(/^(阅读|听力)/g,"")}))}},j=t=>{const{query:c}=b,r=Object.values(t.score_d);if(c.type==="hearing"){const a=[{title:"基础题",include:["听力目的主旨题","听力内容主旨题","听力细节题"]},{title:"强化题",include:["听力推理题","听力句子功能题","听力连结内容题","听力组织结构题"]}],s=r.map(o=>{const i=o.find(e=>e.name.endsWith("Conversation2")||e.name.endsWith("Lecture3")||e.name.endsWith("Lecture4"))?2:1;return{title:"Section "+i,id:i}});return console.log(s),n.allData[0]={layout:"col",name:"听力得分",mockScore:t.score,mockScoreTotal:t.max_score,aiComment:"",list:r.map((o,i)=>({...s[i],children:o.map((e,g)=>({title:e.name.split(/\s/).slice(-1)[0],id:`${i}-${g}`,count:e.count,total:e.total,isComputed:o.score!==null}))}))},n.allData.push(...s.map((o,i)=>{var e,g;return{subtitle:o.title,layout:"row",name:"Raw Score",mockScore:(e=r[i])==null?void 0:e.reduce((d,m)=>d+m.count,0),mockScoreTotal:(g=r[i])==null?void 0:g.reduce((d,m)=>d+m.total,0),...C(a,t.tag_d[i+1]),aiComment:""}})),s}else if(c.type==="spoken"){const a=r[0].map((s,o)=>({title:"Task "+s.name.split(/\s/).slice(-1)[0],id:`${o}`}));return n.allData[0]={layout:"col",name:"口语得分",mockScore:t.questions_r.questions.reduce((s,o)=>s+o.score,0),mockScoreTotal:t.max_score,list:t.questions_r.questions.map((s,o)=>({title:"Task "+s.order,id:o,isComputed:s.score!==null,count:s.score,total:s.max_score}))},n.allData.push(...a.map((s,o)=>{var m;const{model_answer:i,model_answer_content:e}=G(t.questions_r.questions[o]),g=e==null?void 0:e.Content.filter(u=>Object.keys(u).length>0),d=$;return{layout:"col",name:s.title,mockScore:t.questions_r.questions[o].score,mockScoreTotal:t.questions_r.questions[o].max_score,aiComment:(m=e==null?void 0:e.format_G_F)==null?void 0:m.General,model_answer:i,model_answer_content:{...e,sent_back:g.map(u=>Object.keys(u).reduce((f,p)=>{var S;const _=(S=e["Sentence Feedback"][p].Type)==null?void 0:S.reduce((D,k)=>{var h;return{...(h=d.find(x=>x.id===k||x.id.includes(k)))==null?void 0:h.style}},{});return f[p]={...e["Sentence Feedback"][p],original:u[p],style:_,curStyle:{..._},aiStyle:{..._}},f},{}))},question:t.questions_r.questions[o],curIndex:o+1,length:t.questions_r.questions.length,ques_mark:$,list:z.map(u=>{var p,_;const f=Array.isArray(u.key)?u.key.reduce((S,D)=>{var k;return Number((k=e==null?void 0:e.Grades)==null?void 0:k[D])+S},0):(p=e==null?void 0:e.Grades)==null?void 0:p[u.key];return{title:u.title,count:e?(f/2).toFixed(1):(_=e==null?void 0:e.Grades)==null?void 0:_[s.key],isComputed:(e==null?void 0:e.Status)==="OK",total:4}})}})),a}else if(c.type==="writing"){const a=r.map((s,o)=>({title:Number(s[0].name.slice(-1))===1?"Integrated Writing":"Academic discussion",id:`${o}`}));return n.allData[0]={layout:"col",name:"写作得分",mockScore:t.questions_r.questions.reduce((s,o)=>s+o.score,0),mockScoreTotal:t.max_score,list:t.questions_r.questions.map((s,o)=>({title:s.keywords.r===1200?"Integrated Writing":"Academic discussion",id:o,isComputed:s.score!==null,count:s.score,total:s.max_score})),aiComment:""},n.allData.push(...a.map((s,o)=>{var m;const{model_answer:i,model_answer_content:e}=G(t.questions_r.questions[o]),g=e==null?void 0:e.Content.filter(u=>Object.keys(u).length>0),d=s.title==="Integrated Writing"?Q:Y;return console.log(e),{layout:"col",name:s.title,ques_mark:d,mockScore:t.questions_r.questions[o].score,mockScoreTotal:t.questions_r.questions[o].max_score,aiComment:(m=e==null?void 0:e.format_G_F)==null?void 0:m.General,model_answer:i,model_answer_content:{...e,sent_back:g.map(u=>Object.keys(u).reduce((f,p)=>{var S;const _=(S=e["Sentence Feedback"][p].Type)==null?void 0:S.reduce((D,k)=>{var h;return{...(h=d.find(x=>x.id===k||x.id.includes(k)))==null?void 0:h.style}},{});return f[p]={...e["Sentence Feedback"][p],original:u[p],style:_,curStyle:{..._},aiStyle:{..._}},f},{}))},question:t.questions_r.questions[o],curIndex:o+1,length:t.questions_r.questions.length,list:X[s.title].map(u=>({title:u.title,count:(e==null?void 0:e.Grades[u.key])||0,isComputed:(e==null?void 0:e.Grades[u.key])!==null,total:5}))}})),a}else{const a=[{title:"基础题",include:["阅读词汇题","阅读指代题","阅读简化句子题","阅读细节题","阅读排除题"]},{title:"强化题",include:["阅读修辞目的题","阅读插入句子题","阅读推断题"]},{title:"文章小结题",include:["阅读文章内容小结题","阅读表格题"]}],s=r.map((o,i)=>({title:I(o[0].name),id:`${i}`}));return n.allData[0]={layout:"row",name:"模考得分",mockScore:t.score,mockScoreTotal:t.max_score,aiComment:"",...C(a,t.tag_d.all)},n.allData.push(...s.map((o,i)=>{var e,g;return{layout:"row",name:"Raw Score",subtitle:o.title,mockScore:(e=r[i])==null?void 0:e.reduce((d,m)=>d+m.count,0),mockScoreTotal:(g=r[i])==null?void 0:g.reduce((d,m)=>d+m.total,0),aiComment:"",...C(a,t.tag_d[i+1])}})),s}},E=(t,c)=>{const r=Object.keys(t===1?O:R).find(a=>c>=Number(a));return t===1?O[r]:R[r]},A=t=>{console.log("setResultData:::",t),n.questions_r=t.questions_r,n.score_d=Object.values(t.score_d),n.format_question=t.questions_r.questions.reduce((c,r)=>(c.push(...Array.isArray(r.children)&&r.children.length?r.children.map(a=>{var o;const s=(o=r.question_content)==null?void 0:o.split(/\\n/);return{...a,question_parent:{...r,original_question_content:s,question_content:s==null?void 0:s.map(i=>i.replaceAll(r.keywords.k,"")),question_title:r.question_title?r.question_title:"听力原文",children:null}}}):[]),c),[]),q.length=0,q.push({title:"报告",id:"all"},...j(t)),n.title=`${n.score_d[0][0].name.match(/^(TPO\s?\d+)/)[1]} 成绩单`,n.level=E(t.type,t.score),n.loading=!1},N=t=>{const c=[{title:"阅读",id:"reading",layout:"row"},{title:"听力",id:"hearing",layout:"col"},{title:"口语",id:"spoken",layout:"col"},{title:"写作",id:"writing",layout:"table"}];n.questions_r=[],n.score_d=[],n.format_question=[],q.length=0,q[0]={title:"模考",id:"all"},q.push(...c),n.allData[0]={layout:"col",name:"总分",mockScore:t.score,mockScoreTotal:120,aiComment:"",list:c.map((r,a)=>({title:r.title,isComputed:!0,total:t.detail[a].max_score,count:t.detail[a].score}))},n.allData.push(...c.map((r,a)=>({}))),n.loading=!1},L=async t=>{const{query:c}=b;n.title="",n.level="",n.footerActiveIndex=0,n.allData=[],n.aiComment="",n.questions_r={},n.format_question=[],n.score_d=[],n.loading=!0,q.length=0,await T(t);const r=await K(t);if(r.score!==null){if(c.type==="mock"){N(r);return}A(r)}else w(t)},W=P(()=>n.allData[n.footerActiveIndex]);return{getExamResult:L,showHoverMark:(t,c,r,a)=>{var o;((o=n.allData.slice(1)[r])==null?void 0:o.model_answer_content.sent_back).map(i=>{Object.keys(i).map(e=>{a==="hover"?t===e?i[e].curStyle={...i[t].style,"font-weight":"700"}:i[e].curStyle={}:i[e].curStyle=i[e].style})})},curData:W,resultData:n,setShowAnswerHistoryDialog:M,showAnswerHistoryDialog:l,footerData:q}});export{se as a,ne as b,T as c,K as d,re as e,ce as f,ee as g,te as h,ie as i,ae as j,oe as r,le as u};
