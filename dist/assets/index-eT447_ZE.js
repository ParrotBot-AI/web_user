import{H as W,_ as X}from"./HeaderBtn-mYibe7rm.js";import{u as Y,r as K,a as Z,b as G,c as J,d as V,e as ee}from"./result-7MSJ7k2m.js";import{u as te}from"./exam-k0KXsE1s.js";import{X as se,H as ne,N as H,D as L,r as I,v as A,Y as oe,d as S,x as O,q as U,b as w,c as _,e as m,f,t as b,i as D,j as $,F as y,h as x,g as q,A as M,B as R,l as ie,u as E,Z as j,m as P,W as ae,o as le}from"./index-PocizONO.js";import{_ as ce}from"./index.vue_vue_type_script_setup_true_lang-Bs7S7s6p.js";import{_ as N}from"./_plugin-vue_export-helper-x3n3nnut.js";import{_ as ue,D as re}from"./DragBox-v0km-jg6.js";import"./help-Nq3yPxnO.js";import"./index-UrOOk5po.js";const Q=se("hearingExam",()=>{const p=ne(),o=H(),i=te();Y();const n=L([]),a=L([]),l=I({}),t=I(0),e=async s=>{const{query:d}=o;l.value={},t.value=d!=null&&d.step?Number(d==null?void 0:d.step):0;try{const[r,g]=await Promise.all([K(s),Z(s)]);l.value=r;let v=0;const B=r.questions.reduce((k,T)=>k+T.children.length,0);l.value.formatQuestion=r.questions.reduce((k,T,Ae)=>(k.push({type:"audio",voice_link:T.voice_link,question_id:T.question_id,order:v+1,title:"Please listen carefully.",url:T.voice_link,headBtns:{horn:{title:"horn",id:"horn",disabled:!1,isShow:!0},continue:{title:"CONTINUE",id:"continue",disabled:!1,isShow:!0,onClick:()=>{t.value++}}}}),T.children.forEach((C,Oe)=>{v++,C.voice_link&&k.push({type:"audio",voice_link:C.voice_link,question_id:C.question_id,order:v,title:"Please listen carefully.",url:C.voice_link,headBtns:{horn:{title:"horn",id:"horn",disabled:!0,isShow:!0},continue:{title:"CONTINUE",id:"continue",disabled:!1,isShow:!0,onClick:()=>{t.value++}}}}),k.push({...C,type:"question",order:v,headBtns:{help:{title:"HELP",id:"help",disabled:!1,isShow:!0,onClick:()=>{console.log("help")}},prev:{title:"BACK",disabled:!1,id:"prev",isShow:!0,onClick:()=>{t.value>0&&t.value--}},next:{title:"NEXT",id:"next",disabled:!1,isShow:B!==v,onClick:()=>{t.value++}},submit:{title:"SUBMIT",id:"submit",disabled:!1,isShow:B===v,onClick:()=>{u()}}}})}),k),[{type:"info",headBtns:{continue:{title:"CONTINUE",id:"continue",disabled:!1,isShow:!0,onClick:()=>{t.value++}}},title:"Listening",info_title:"Listening Section Directions",is_show_footer:!0,question_title:["In this section, you will be able to demonstrate your ability to understand conversations and lectures in English. The section is divided into two separately timed parts. You will hear each conversation or lecture only one time.","A clock will indicate how much time remains. The clock will count down only while you are answering questions, not while you are listening. In some questions, you",'will see this icon: <div class="listen-icon"></div> . This means that you will hear, but not see, part of the question.','You must answer each question. After you answer, select <button class="nextbtn">Next</button> . In the actual test, you cannot return to previous questions.']}]),a.length=0,a.push(...g),l.value.sumQuesLength=B}catch{p.back()}},c=A(()=>{var s,d,r;return(s=l.value)!=null&&s.formatQuestion?(p.replace({query:{...o.query,step:t.value}}),(r=(d=l.value)==null?void 0:d.formatQuestion)==null?void 0:r[t.value]):{}}),u=async()=>{const{query:s,meta:d}=o;if(await G(s==null?void 0:s.id),(s==null?void 0:s.type)==="mixedExam"&&(s!=null&&s.mid)&&(s!=null&&s.mid)){const r=oe(`mixedExam-${s==null?void 0:s.mid}`);await J(s==null?void 0:s.id),await V(s==null?void 0:s.id),await i.startExam("mock_exam",r==null?void 0:r.quesid[1],r==null?void 0:r.father_sheet),p.push({name:"spokenExam",query:{type:"mixedExam",mid:r==null?void 0:r.father_sheet,name:r.resource_name,id:i.examing_data.sheet_id}});return}p.push(`/result/${s==null?void 0:s.id}?type=${d==null?void 0:d.parent}`)};return{questionData:l,saveQuestion:async(s,d)=>{const{query:r}=o,g=a.findIndex(v=>v.question_id===s);a[g]={question_id:s,is_answer:!0,answer:d},await ee({sheet_id:r==null?void 0:r.id,question_id:s,answer:d,duration:0})},curQuestion:c,processData:n,answerData:a,getExamData:e,requestSubmitExam:u}}),_e={class:"px-32"},de={class:"pt-16 pb-14 text-[#475467] text-xl"},pe={class:"flex-1 overflow-hidden text-wrap"},he=S({__name:"Mc",props:{question_title:{},detail:{},question_id:{},options_label:{},question_content:{},restriction:{}},setup(p){const o=Q(),i=I([]),n=p;return O(()=>{var l,t;const a=(l=o==null?void 0:o.answerData)==null?void 0:l.find(e=>e.question_id===n.question_id);a!=null&&a.is_answer&&(i.value=(t=a==null?void 0:a.answer)==null?void 0:t.reduce((e,c,u)=>(c===1&&e.push(u),e),[]))}),U(()=>i.value,()=>{var t,e;i.value.length>n.restriction.rc&&i.value.shift();const a=n.options_label.map((c,u)=>Number(Object.values(i.value).includes(u))),l=(e=(t=o==null?void 0:o.answerData)==null?void 0:t.find(c=>c.question_id===n.question_id))==null?void 0:e.answer;i.value.length===n.restriction.rc&&a.toString()!==(l==null?void 0:l.toString())&&o.saveQuestion(n.question_id,a)}),(a,l)=>{const t=w("a-checkbox"),e=w("a-checkbox-group");return _(),m("div",_e,[f("h2",de,b(n.question_content),1),D(e,{value:i.value,"onUpdate:value":l[0]||(l[0]=c=>i.value=c),class:"flex flex-col"},{default:$(()=>[(_(!0),m(y,null,q(n.detail,(c,u)=>(_(),x(t,{key:u,value:u,class:"flex pb-7 text-gray-500 mycheckbox flex-row"},{default:$(()=>[f("p",pe,b(c),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])}}}),F=N(he,[["__scopeId","data-v-c7e5ff28"]]),z=p=>(M("data-v-96330829"),p=p(),R(),p),me={class:"px-32"},fe={class:"pt-16 pb-14 text-[#475467] text-xl"},ve=z(()=>f("h2",{class:"text-gray-500 text-[16px] font-bold pb-3 pt-4"},"Answer Choices",-1)),xe={class:"flex flex-wrap w-[calc(100%+20px)] -ml-[10px]"},we=z(()=>f("div",{class:"py-2 px-4 mt-4 bg-[#F6F6F6] text-[#475467] text-base"},"Directions: Drag your answer choices to the spaces here they belong. To remove an answer choice, click on it. To review the passage, click VIEW TEXT.",-1)),ge=S({__name:"Order",props:{question_title:{},detail:{},question_id:{},options_label:{},question_content:{},answer:{}},setup(p){const o=Q(),i=I([]),n=p,a=A(()=>n.detail.reduce((e,c,u)=>(e[u]=c,e),{}));O(()=>{var u;const e=(u=o==null?void 0:o.answerData)==null?void 0:u.find(h=>h.question_id===n.question_id),c=e==null?void 0:e.answer.map(h=>`${h}`);e!=null&&e.is_answer&&(i.value=c)});const l=({type:e,index:c})=>{i.value[c]=e,i.value.length===n.answer.length&&o.saveQuestion(n.question_id,i.value)},t=({index:e})=>{i.value[e]=""};return(e,c)=>(_(),m("div",me,[f("h2",fe,b(n.question_content),1),f("div",null,[(_(!0),m(y,null,q(n.answer,(u,h)=>(_(),x(ue,{key:h,checked:i.value,resource:a.value,onDrop:l,onDel:t,accept:["0","1","2"],index:h},null,8,["checked","resource","index"]))),128))]),ve,f("div",xe,[(_(!0),m(y,null,q(n.detail,(u,h)=>(_(),x(re,{key:h,val:u,type:`${h}`,res:i.value},null,8,["val","type","res"]))),128))]),we]))}}),be=N(ge,[["__scopeId","data-v-96330829"]]),ke={class:"px-32"},ye={class:"pt-16 pb-14 text-[#475467] text-xl"},qe=S({__name:"Sc",props:{question_title:{},detail:{},question_id:{},options_label:{},question_content:{}},setup(p){const o=Q(),i=I(-1),n=p;return U(()=>n.question_id,()=>{var l;const a=(l=o==null?void 0:o.answerData)==null?void 0:l.find(t=>t.question_id===n.question_id);if(a.is_answer){const t=(a==null?void 0:a.answer.findIndex(e=>e===1))??-1;i.value=t}else i.value=-1},{immediate:!0}),U(()=>i.value,()=>{var t;const a=n.options_label.map((e,c)=>c===i.value?1:0),l=(t=o==null?void 0:o.answerData.find(e=>e.question_id===n.question_id))==null?void 0:t.answer;i.value>-1&&a.toString()!==(l==null?void 0:l.toString())&&o.saveQuestion(n.question_id,a)}),(a,l)=>{const t=w("a-radio"),e=w("a-radio-group");return _(),m("div",ke,[f("h2",ye,b(n.question_content),1),D(e,{value:i.value,"onUpdate:value":l[0]||(l[0]=c=>i.value=c)},{default:$(()=>[(_(!0),m(y,null,q(n.detail,(c,u)=>(_(),x(t,{key:u,value:u,class:"flex pb-7 text-gray-500 myraido"},{default:$(()=>[ie(b(n.options_label[u])+". "+b(c),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])])}}}),$e=N(qe,[["__scopeId","data-v-13f51fac"]]),Ee=p=>(M("data-v-5b92fdc8"),p=p(),R(),p),Te={class:"px-32"},Ie={class:"pt-16 pb-8 text-[#475467] text-xl"},De=Ee(()=>f("p",{class:"bg-[#f0f0f0] text-center py-4 mb-3"},"Click in the correct box for each phrase",-1)),Se={class:"w-full my-table"},Qe={class:"my-thead"},Be=S({__name:"Tf",props:{question_title:{},detail:{},keywords:{},question_id:{},options_label:{},question_content:{}},setup(p){const o=Q(),i=L([]),n=A(()=>{var t,e;return[{title:"",dataIndex:"val"},...(e=(t=a.keywords)==null?void 0:t.h)==null?void 0:e.map((c,u)=>({title:c,dataIndex:u}))]}),a=p;O(()=>{const t=o==null?void 0:o.answerData.find(e=>e.question_id===a.question_id);i.length=0,i.push(...a.detail.map((e,c)=>({val:e,checkVal:t!=null&&t.is_answer?t.answer[c]:-1})))});const l=()=>{i.every(t=>t.checkVal>-1)&&o.saveQuestion(a.question_id,i.map(t=>t.checkVal))};return(t,e)=>{const c=w("a-radio"),u=w("a-radio-group");return _(),m("div",Te,[f("h2",Ie,b(a.question_content),1),De,f("div",Se,[f("div",Qe,[(_(!0),m(y,null,q(n.value,h=>(_(),m("span",{key:h.dataIndex},b(h.title),1))),128))]),(_(!0),m(y,null,q(i,(h,s)=>(_(),m("div",{class:"my-trow",key:s},[f("span",null,b(h[n.value[0].dataIndex]),1),D(u,{value:h.checkVal,"onUpdate:value":d=>h.checkVal=d,onChange:l},{default:$(()=>[(_(!0),m(y,null,q(n.value.slice(1),(d,r)=>(_(),x(c,{key:r,value:r+1},null,8,["value"]))),128))]),_:2},1032,["value","onUpdate:value"])]))),128))])])}}}),Ce=N(Be,[["__scopeId","data-v-5b92fdc8"]]),Ne={class:"bg-white w-full h-full"},Le={class:"flex flex-1 justify-center items-center overflow-hidden bg-white"},Ue=S({__name:"QuestionItem",props:{item:{}},setup(p){const o=Q(),i={Toefl_Listening_sc:$e,Toefl_Listening_mc_2:F,Toefl_Listening_mc_3:F,Toefl_Listening_orde:be,Toefl_Listening_tf:Ce},n=p,a=()=>{console.log("onEnded")};return(l,t)=>{var u,h,s,d,r;const e=w("BQuesTimer"),c=w("BQuesTitle");return _(),m("div",Ne,[D(c,{title:n.title,index:(u=n.item)==null?void 0:u.order,length:(h=E(o).questionData)==null?void 0:h.sumQuesLength},{right:$(()=>{var g,v;return[D(e,{times:(v=(g=E(o))==null?void 0:g.questionData)==null?void 0:v.time_remain},null,8,["times"])]}),_:1},8,["title","index","length"]),f("div",Le,[((s=n.item)==null?void 0:s.type)==="audio"?(_(),x(ce,{key:0,ended:a,title:"Please listen carefully.",class:"mt-20",img:"2",url:(d=n.item)==null?void 0:d.voice_link},null,8,["url"])):(_(),x(ae(i[(r=n.item)==null?void 0:r.question_type]),j(P({key:1},n.item)),null,16))])])}}}),Pe={class:"flex"},Ke=S({__name:"index",setup(p){const o=Q(),{query:i}=H(),n=I(!0);return le(async()=>{await o.getExamData(i.id),n.value=!1}),(a,l)=>{const t=w("a-spin"),e=w("b-header"),c=w("a-layout");return n.value?(_(),x(t,{key:0,size:"large",tip:"试题加载中...",class:"fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-50"})):(_(),x(c,{key:1,class:"w-full h-full flex flex-col"},{default:$(()=>{var u,h,s,d,r;return[D(e,{title:((u=E(i))==null?void 0:u.name)||"模拟考试"},{right:$(()=>{var g,v;return[f("div",Pe,[(_(!0),m(y,null,q((v=(g=E(o))==null?void 0:g.curQuestion)==null?void 0:v.headBtns,(B,k)=>(_(),x(W,P(B,{key:k}),null,16))),128))])]}),_:1},8,["title"]),((s=(h=E(o))==null?void 0:h.curQuestion)==null?void 0:s.type)==="info"?(_(),x(X,j(P({key:0},(d=E(o))==null?void 0:d.curQuestion)),null,16)):(_(),x(Ue,{key:1,item:(r=E(o))==null?void 0:r.curQuestion,title:"Listening"},null,8,["item"]))]}),_:1}))}}});export{Ke as default};
